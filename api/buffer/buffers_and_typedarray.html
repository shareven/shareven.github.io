<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>Buffer 与 TypedArray | Node.js API 文档</title>
  <link rel="icon" sizes="32x32" type="image/png" href="http://static.nodejs.cn/_static/img/favicon.png"><link rel="stylesheet" href="/api/api.css">
  <script>
    document.write('<link href="http://nodejs.cn/api/buffer/'&#32;+&#32;(location.port?'':'//static.nodejs.cn')&#32;+&#32;'/_static/css/api.css?1576756294526" rel="stylesheet">')
  </script>
</head>
<body class="alt apidoc" id="page_api_item">
  <div id="api-section-buffer">
    <div id="content" class="clearfix">
  
      <div id="column1" data-id="__ID__" class="interior">
        <header>
          <h1>Buffer 与 TypedArray</h1>
          <div id="gtoc">
            <ul>
              <li>v12.14.0</li>
              <li>
                <a href="../buffer.html#buffer_buffers_and_typedarray" name="toc">返回上层文档</a>
              </li>
              <li>
                <a href="https://github.com/nodejscn/node-api-cn/edit/master/buffer/buffers_and_typedarray.md" rel="nofollow" target="_blank">提交修改</a>
              </li>
              <li>
                <a href="http://nodejs.cn/search" name="toc">搜索</a>
              </li>
            </ul>
          </div>
          <hr>
        </header>

        <div id="biz_item"></div>
  
        <div id="apicontent">
          <div id="content_left"><div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v3.0.0</td>
<td><p>The <code>Buffer</code>s class now inherits from <code>Uint8Array</code>.</p></td></tr>
</tbody></table>
</details>
</div><p><code>Buffer</code> &#x5B9E;&#x4F8B;&#x4E5F;&#x662F; <a href="http://nodejs.cn/s/ZbDkpm" rel="nofollow"><code>Uint8Array</code></a> &#x5B9E;&#x4F8B;&#xFF0C;&#x4F46;&#x662F;&#x4E0E; <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> &#x6709;&#x5FAE;&#x5C0F;&#x7684;&#x4E0D;&#x540C;&#x3002;
&#x4F8B;&#x5982;&#xFF0C;<a href="http://nodejs.cn/s/Ue6KZm" rel="nofollow"><code>ArrayBuffer#slice()</code></a> &#x4F1A;&#x521B;&#x5EFA;&#x5207;&#x7247;&#x7684;&#x62F7;&#x8D1D;&#xFF0C;&#x800C; <a href="http://nodejs.cn/s/uQPgxt" rel="nofollow"><code>Buffer#slice()</code></a> &#x662F;&#x5728;&#x73B0;&#x6709;&#x7684; <code>Buffer</code> &#x4E0A;&#x521B;&#x5EFA;&#x800C;&#x4E0D;&#x62F7;&#x8D1D;&#xFF0C;&#x8FD9;&#x4F7F;&#x5F97; <a href="http://nodejs.cn/s/uQPgxt" rel="nofollow"><code>Buffer#slice()</code></a> &#x6548;&#x7387;&#x66F4;&#x9AD8;&#x3002;</p><p>&#x4E5F;&#x53EF;&#x4EE5;&#x4ECE;&#x4E00;&#x4E2A; <code>Buffer</code> &#x521B;&#x5EFA;&#x65B0;&#x7684; <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> &#x5B9E;&#x4F8B;&#xFF0C;&#x4F46;&#x9700;&#x8981;&#x6CE8;&#x610F;&#x4EE5;&#x4E0B;&#x4E8B;&#x9879;&#xFF1A;</p><ol>
<li>
<p><code>Buffer</code> &#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x662F;&#x88AB;&#x62F7;&#x8D1D;&#x5230; <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5171;&#x4EAB;&#x3002;</p>
</li>
<li>
<p><code>Buffer</code> &#x5BF9;&#x8C61;&#x7684;&#x5185;&#x5B58;&#x662F;&#x88AB;&#x89E3;&#x91CA;&#x4E3A;&#x4E0D;&#x540C;&#x5143;&#x7D20;&#x7684;&#x6570;&#x7EC4;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x76EE;&#x6807;&#x7C7B;&#x578B;&#x7684;&#x5B57;&#x8282;&#x6570;&#x7EC4;&#x3002;
&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#xFF0C; <code>new Uint32Array(Buffer.from([1, 2, 3, 4]))</code> &#x4F1A;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5E26;&#x6709; 4 &#x4E2A;&#x5143;&#x7D20; <code>[1, 2, 3, 4]</code> &#x7684; <a href="http://nodejs.cn/s/xF6oKR" rel="nofollow"><code>Uint32Array</code></a>&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5E26;&#x6709;&#x5355;&#x4E2A;&#x5143;&#x7D20; <code>[0x1020304]</code> &#x6216; <code>[0x4030201]</code> &#x7684; <a href="http://nodejs.cn/s/xF6oKR" rel="nofollow"><code>Uint32Array</code></a>&#x3002;</p>
</li>
</ol><p>&#x901A;&#x8FC7;&#x4F7F;&#x7528; <code>TypedArray</code> &#x5BF9;&#x8C61;&#x7684; <code>.buffer</code> &#x5C5E;&#x6027;&#xFF0C;&#x53EF;&#x4EE5;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x4E0E; <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> &#x5B9E;&#x4F8B;&#x5171;&#x4EAB;&#x76F8;&#x540C;&#x5185;&#x5B58;&#x7684;&#x65B0; <code>Buffer</code>&#x3002; </p><pre><code class="language-js">const arr = new Uint16Array(2);

arr[0] = 5000;
arr[1] = 4000;

// &#x62F7;&#x8D1D; `arr` &#x7684;&#x5185;&#x5BB9;&#x3002;
const buf1 = Buffer.from(arr);
// &#x4E0E; `arr` &#x5171;&#x4EAB;&#x5185;&#x5B58;&#x3002;
const buf2 = Buffer.from(arr.buffer);

console.log(buf1);
// &#x6253;&#x5370;: &lt;Buffer 88 a0&gt;
console.log(buf2);
// &#x6253;&#x5370;: &lt;Buffer 88 13 a0 0f&gt;

arr[1] = 6000;

console.log(buf1);
// &#x6253;&#x5370;: &lt;Buffer 88 a0&gt;
console.log(buf2);
// &#x6253;&#x5370;: &lt;Buffer 88 13 70 17&gt;
</code></pre><p>&#x5F53;&#x4F7F;&#x7528; <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> &#x7684; <code>.buffer</code> &#x521B;&#x5EFA; <code>Buffer</code> &#x65F6;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4F20;&#x5165; <code>byteOffset</code> &#x548C; <code>length</code> &#x53C2;&#x6570;&#x53EA;&#x4F7F;&#x7528; <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> &#x7684;&#x4E00;&#x90E8;&#x5206;&#x3002;</p><pre><code class="language-js">const arr = new Uint16Array(20);
const buf = Buffer.from(arr.buffer, 0, 16);

console.log(buf.length);
// &#x6253;&#x5370;: 16
</code></pre><p><code>Buffer.from()</code> &#x4E0E; <a href="http://nodejs.cn/s/jLHsN8" rel="nofollow"><code>TypedArray.from()</code></a> &#x6709;&#x7740;&#x4E0D;&#x540C;&#x7684;&#x5B9E;&#x73B0;&#x3002;
&#x5177;&#x4F53;&#x6765;&#x8BF4;&#xFF0C;<a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> &#x53EF;&#x4EE5;&#x63A5;&#x53D7;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x4F5C;&#x4E3A;&#x6620;&#x5C04;&#x51FD;&#x6570;&#xFF0C;&#x5728;&#x7C7B;&#x578B;&#x6570;&#x7EC4;&#x7684;&#x6BCF;&#x4E2A;&#x5143;&#x7D20;&#x4E0A;&#x8C03;&#x7528;&#xFF1A;</p><ul>
<li><code>TypedArray.from(source[, mapFn[, thisArg]])</code></li>
</ul><p><code>Buffer.from()</code> &#x5219;&#x4E0D;&#x652F;&#x6301;&#x6620;&#x5C04;&#x51FD;&#x6570;&#x7684;&#x4F7F;&#x7528;&#xFF1A;</p><ul>
<li><a href="http://nodejs.cn/s/F5r61t" rel="nofollow"><code>Buffer.from(array)</code></a></li>
<li><a href="http://nodejs.cn/s/SPUnUK" rel="nofollow"><code>Buffer.from(buffer)</code></a></li>
<li><a href="http://nodejs.cn/s/jGD2qK" rel="nofollow"><code>Buffer.from(arrayBuffer[, byteOffset[, length]])</code></a></li>
<li><a href="http://nodejs.cn/s/X7oqVF" rel="nofollow"><code>Buffer.from(string[, encoding])</code></a></li>
</ul></div>
          <div id="content_right"><div class="api_metadata">
<details class="changelog"><summary>History</summary>
<table>
<tbody><tr><th>Version</th><th>Changes</th></tr>
<tr><td>v3.0.0</td>
<td><p>The <code>Buffer</code>s class now inherits from <code>Uint8Array</code>.</p></td></tr>
</tbody></table>
</details>
</div><p><code>Buffer</code> instances are also <a href="http://nodejs.cn/s/ZbDkpm" rel="nofollow"><code>Uint8Array</code></a> instances. However, there are
subtle incompatibilities with <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a>. For example, while
<a href="http://nodejs.cn/s/Ue6KZm" rel="nofollow"><code>ArrayBuffer#slice()</code></a> creates a copy of the slice, the implementation of
<a href="http://nodejs.cn/s/uQPgxt" rel="nofollow"><code>Buffer#slice()</code></a> creates a view over the existing <code>Buffer</code>
without copying, making <a href="http://nodejs.cn/s/uQPgxt" rel="nofollow"><code>Buffer#slice()</code></a> far more efficient.</p><p>It is also possible to create new <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> instances from a <code>Buffer</code>
with the following caveats:</p><ol>
<li>
<p>The <code>Buffer</code> object&apos;s memory is copied to the <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a>, not shared.</p>
</li>
<li>
<p>The <code>Buffer</code> object&apos;s memory is interpreted as an array of distinct
elements, and not as a byte array of the target type. That is,
<code>new Uint32Array(Buffer.from([1, 2, 3, 4]))</code> creates a 4-element
<a href="http://nodejs.cn/s/xF6oKR" rel="nofollow"><code>Uint32Array</code></a> with elements <code>[1, 2, 3, 4]</code>, not a <a href="http://nodejs.cn/s/xF6oKR" rel="nofollow"><code>Uint32Array</code></a> with a
single element <code>[0x1020304]</code> or <code>[0x4030201]</code>.</p>
</li>
</ol><p>It is possible to create a new <code>Buffer</code> that shares the same allocated memory as
a <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> instance by using the <code>TypedArray</code> object&apos;s <code>.buffer</code>
property.</p><pre><code class="language-js">const arr = new Uint16Array(2);

arr[0] = 5000;
arr[1] = 4000;

// Copies the contents of `arr`.
const buf1 = Buffer.from(arr);
// Shares memory with `arr`.
const buf2 = Buffer.from(arr.buffer);

console.log(buf1);
// Prints: &lt;Buffer 88 a0&gt;
console.log(buf2);
// Prints: &lt;Buffer 88 13 a0 0f&gt;

arr[1] = 6000;

console.log(buf1);
// Prints: &lt;Buffer 88 a0&gt;
console.log(buf2);
// Prints: &lt;Buffer 88 13 70 17&gt;
</code></pre><p>When creating a <code>Buffer</code> using a <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a>&apos;s <code>.buffer</code>, it is
possible to use only a portion of the underlying <a href="http://nodejs.cn/s/mUbfvF" rel="nofollow"><code>ArrayBuffer</code></a> by passing in
<code>byteOffset</code> and <code>length</code> parameters.</p><pre><code class="language-js">const arr = new Uint16Array(20);
const buf = Buffer.from(arr.buffer, 0, 16);

console.log(buf.length);
// Prints: 16
</code></pre><p>The <code>Buffer.from()</code> and <a href="http://nodejs.cn/s/jLHsN8" rel="nofollow"><code>TypedArray.from()</code></a> have different signatures and
implementations. Specifically, the <a href="http://nodejs.cn/s/oh3CkV" rel="nofollow"><code>TypedArray</code></a> variants accept a second
argument that is a mapping function that is invoked on every element of the
typed array:</p><ul>
<li><code>TypedArray.from(source[, mapFn[, thisArg]])</code></li>
</ul><p>The <code>Buffer.from()</code> method, however, does not support the use of a mapping
function:</p><ul>
<li><a href="http://nodejs.cn/s/F5r61t" rel="nofollow"><code>Buffer.from(array)</code></a></li>
<li><a href="http://nodejs.cn/s/SPUnUK" rel="nofollow"><code>Buffer.from(buffer)</code></a></li>
<li><a href="http://nodejs.cn/s/jGD2qK" rel="nofollow"><code>Buffer.from(arrayBuffer[, byteOffset[, length]])</code></a></li>
<li><a href="http://nodejs.cn/s/X7oqVF" rel="nofollow"><code>Buffer.from(string[, encoding])</code></a></li>
</ul></div>
          <div></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.write('<script src="http://nodejs.cn/api/buffer/'&#32;+&#32;(location.port&#32;?&#32;''&#32;:&#32;'//static.nodejs.cn')&#32;+&#32;'/_static/js/api.js?1576756294526"><\/script>');
  </script>
</body>
</html>