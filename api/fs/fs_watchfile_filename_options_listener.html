<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>fs.watchFile(filename[, options], listener) | Node.js API 文档</title>
  <link rel="icon" sizes="32x32" type="image/png" href="http://static.nodejs.cn/_static/img/favicon.png"><link rel="stylesheet" href="/api/api.css">
  <script>
    document.write('<link href="http://nodejs.cn/api/fs/'&#32;+&#32;(location.port?'':'//static.nodejs.cn')&#32;+&#32;'/_static/css/api.css?1576756310153" rel="stylesheet">')
  </script>
</head>
<body class="alt apidoc" id="page_api_item">
  <div id="api-section-fs">
    <div id="content" class="clearfix">
  
      <div id="column1" data-id="__ID__" class="interior">
        <header>
          <h1>fs.watchFile(filename[, options], listener)</h1>
          <div id="gtoc">
            <ul>
              <li>v12.14.0</li>
              <li>
                <a href="../fs.html#fs_fs_watchfile_filename_options_listener" name="toc">返回上层文档</a>
              </li>
              <li>
                <a href="https://github.com/nodejscn/node-api-cn/edit/master/fs/fs_watchfile_filename_options_listener.md" rel="nofollow" target="_blank">提交修改</a>
              </li>
              <li>
                <a href="http://nodejs.cn/search" name="toc">搜索</a>
              </li>
            </ul>
          </div>
          <hr>
        </header>

        <div id="biz_item"></div>
  
        <div id="apicontent">
          <div id="content_left"><div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v7.6.0</td>
<td><p>The <code>filename</code> parameter can be a WHATWG <code>URL</code> object using <code>file:</code> protocol. Support is currently still <em>experimental</em>.</p></td></tr>
<tr><td>v0.1.31</td>
<td><p><span>&#x65B0;&#x589E;&#x4E8E;: v0.1.31</span></p></td></tr>
</tbody></table>
</details>
</div><ul>
<li><code>filename</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> | <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="nofollow" class="type">&lt;Buffer&gt;</a> | <a href="http://nodejs.cn/s/5dwq7G" target="_blank" rel="nofollow" class="type">&lt;URL&gt;</a></li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>persistent</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>interval</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>5007</code>&#x3002;</li>
</ul>
</li>
<li>
<p><code>listener</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a></p>
<ul>
<li><code>current</code> <a href="http://nodejs.cn/s/NMuvVx" target="_blank" rel="nofollow" class="type">&lt;fs.Stats&gt;</a></li>
<li><code>previous</code> <a href="http://nodejs.cn/s/NMuvVx" target="_blank" rel="nofollow" class="type">&lt;fs.Stats&gt;</a></li>
</ul>
</li>
</ul><p>&#x76D1;&#x89C6; <code>filename</code> &#x7684;&#x66F4;&#x6539;&#x3002;
&#x6BCF;&#x5F53;&#x8BBF;&#x95EE;&#x6587;&#x4EF6;&#x65F6;&#x90FD;&#x4F1A;&#x8C03;&#x7528; <code>listener</code> &#x56DE;&#x8C03;&#x3002;</p><p><code>options</code> &#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x7701;&#x7565;&#x3002;
&#x5982;&#x679C;&#x63D0;&#x4F9B;&#xFF0C;&#x5219;&#x5B83;&#x5E94;&#x8BE5;&#x662F;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;
<code>options</code> &#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x540D;&#x4E3A; <code>persistent</code> &#x7684;&#x5E03;&#x5C14;&#x503C;&#xFF0C;&#x6307;&#x793A;&#x5F53;&#x6587;&#x4EF6;&#x6B63;&#x5728;&#x88AB;&#x76D1;&#x89C6;&#x65F6;&#xFF0C;&#x8FDB;&#x7A0B;&#x662F;&#x5426;&#x5E94;&#x8BE5;&#x7EE7;&#x7EED;&#x8FD0;&#x884C;&#x3002;
<code>options</code> &#x5BF9;&#x8C61;&#x53EF;&#x4EE5;&#x6307;&#x5B9A; <code>interval</code> &#x5C5E;&#x6027;&#xFF0C;&#x6307;&#x793A;&#x8F6E;&#x8BE2;&#x76EE;&#x6807;&#x7684;&#x9891;&#x7387;&#xFF08;&#x4EE5;&#x6BEB;&#x79D2;&#x4E3A;&#x5355;&#x4F4D;&#xFF09;&#x3002;</p><p><code>listener</code> &#x6709;&#x4E24;&#x4E2A;&#x53C2;&#x6570;&#xFF0C;&#x5F53;&#x524D;&#x7684; stat &#x5BF9;&#x8C61;&#x548C;&#x4E4B;&#x524D;&#x7684; stat &#x5BF9;&#x8C61;&#xFF1A;</p><pre><code class="language-js">fs.watchFile(&apos;message.text&apos;, (curr, prev) =&gt; {
  console.log(`&#x5F53;&#x524D;&#x7684;&#x6700;&#x8FD1;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#x662F;: ${curr.mtime}`);
  console.log(`&#x4E4B;&#x524D;&#x7684;&#x6700;&#x8FD1;&#x4FEE;&#x6539;&#x65F6;&#x95F4;&#x662F;: ${prev.mtime}`);
});
</code></pre><p>&#x8FD9;&#x4E9B; stat &#x5BF9;&#x8C61;&#x662F; <code>fs.Stat</code> &#x7684;&#x5B9E;&#x4F8B;&#x3002;</p><p>&#x8981;&#x5728;&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#xFF08;&#x800C;&#x4E0D;&#x4EC5;&#x4EC5;&#x662F;&#x8BBF;&#x95EE;&#xFF09;&#x65F6;&#x6536;&#x5230;&#x901A;&#x77E5;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x6BD4;&#x8F83; <code>curr.mtime</code> &#x548C; <code>prev.mtime</code>&#x3002;</p><p>&#x5F53; <code>fs.watchFile</code> &#x64CD;&#x4F5C;&#x5BFC;&#x81F4; <code>ENOENT</code> &#x9519;&#x8BEF;&#x65F6;&#xFF0C;&#x5B83;&#x5C06;&#x8C03;&#x7528;&#x4E00;&#x6B21;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x5E76;&#x5C06;&#x6240;&#x6709;&#x5B57;&#x6BB5;&#x7F6E;&#x96F6;&#xFF08;&#x6216;&#x5C06;&#x65E5;&#x671F;&#x8BBE;&#x4E3A; Unix &#x7EAA;&#x5143;&#xFF09;&#x3002;
&#x5982;&#x679C;&#x6587;&#x4EF6;&#x662F;&#x5728;&#x90A3;&#x4E4B;&#x540E;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x5219;&#x76D1;&#x542C;&#x5668;&#x4F1A;&#x88AB;&#x518D;&#x6B21;&#x8C03;&#x7528;&#xFF0C;&#x4E14;&#x5E26;&#x4E0A;&#x6700;&#x65B0;&#x7684; stat &#x5BF9;&#x8C61;&#x3002;
&#x8FD9;&#x662F; v0.10 &#x4E4B;&#x540E;&#x7684;&#x529F;&#x80FD;&#x53D8;&#x5316;&#x3002;</p><p>&#x4F7F;&#x7528; <a href="http://nodejs.cn/s/h2QY7Q" rel="nofollow"><code>fs.watch()</code></a> &#x6BD4; <code>fs.watchFile</code> &#x548C; <code>fs.unwatchFile</code> &#x66F4;&#x9AD8;&#x6548;&#x3002;
&#x5E94;&#x5C3D;&#x53EF;&#x80FD;&#x4F7F;&#x7528; <code>fs.watch</code> &#x4EE3;&#x66FF; <code>fs.watchFile</code> &#x548C; <code>fs.unwatchFile</code>&#x3002;</p><p>&#x5F53; <code>fs.watchFile()</code> &#x6B63;&#x5728;&#x76D1;&#x89C6;&#x7684;&#x6587;&#x4EF6;&#x6D88;&#x5931;&#x5E76;&#x91CD;&#x65B0;&#x51FA;&#x73B0;&#x65F6;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x56DE;&#x8C03;&#x4E8B;&#x4EF6;&#xFF08;&#x6587;&#x4EF6;&#x91CD;&#x65B0;&#x51FA;&#x73B0;&#xFF09;&#x8FD4;&#x56DE;&#x7684; <code>previousStat</code> &#x4F1A;&#x4E0E;&#x7B2C;&#x4E00;&#x6B21;&#x56DE;&#x8C03;&#x4E8B;&#x4EF6;&#xFF08;&#x6587;&#x4EF6;&#x6D88;&#x5931;&#xFF09;&#x8FD4;&#x56DE;&#x7684; <code>previousStat</code> &#x76F8;&#x540C;&#x3002;</p><p>&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x53D1;&#x751F;&#x5728;:</p><ul>
<li>&#x6587;&#x4EF6;&#x88AB;&#x5220;&#x9664;&#xFF0C;&#x7136;&#x540E;&#x53C8;&#x6062;&#x590D;&#x3002;</li>
<li>&#x6587;&#x4EF6;&#x88AB;&#x91CD;&#x547D;&#x540D;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7B2C;&#x4E8C;&#x6B21;&#x91CD;&#x547D;&#x540D;&#x56DE;&#x5176;&#x539F;&#x6765;&#x7684;&#x540D;&#x79F0;&#x3002;</li>
</ul></div>
          <div id="content_right"><div class="api_metadata">
<details class="changelog"><summary>History</summary>
<table>
<tbody><tr><th>Version</th><th>Changes</th></tr>
<tr><td>v7.6.0</td>
<td><p>The <code>filename</code> parameter can be a WHATWG <code>URL</code> object using <code>file:</code> protocol. Support is currently still <em>experimental</em>.</p></td></tr>
<tr><td>v0.1.31</td>
<td><p><span>Added in: v0.1.31</span></p></td></tr>
</tbody></table>
</details>
</div><ul>
<li><code>filename</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> | <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="nofollow" class="type">&lt;Buffer&gt;</a> | <a href="http://nodejs.cn/s/5dwq7G" target="_blank" rel="nofollow" class="type">&lt;URL&gt;</a></li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>persistent</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> <strong>Default:</strong> <code>true</code></li>
<li><code>interval</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> <strong>Default:</strong> <code>5007</code></li>
</ul>
</li>
<li>
<p><code>listener</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a></p>
<ul>
<li><code>current</code> <a href="http://nodejs.cn/s/NMuvVx" target="_blank" rel="nofollow" class="type">&lt;fs.Stats&gt;</a></li>
<li><code>previous</code> <a href="http://nodejs.cn/s/NMuvVx" target="_blank" rel="nofollow" class="type">&lt;fs.Stats&gt;</a></li>
</ul>
</li>
</ul><p>Watch for changes on <code>filename</code>. The callback <code>listener</code> will be called each
time the file is accessed.</p><p>The <code>options</code> argument may be omitted. If provided, it should be an object. The
<code>options</code> object may contain a boolean named <code>persistent</code> that indicates
whether the process should continue to run as long as files are being watched.
The <code>options</code> object may specify an <code>interval</code> property indicating how often the
target should be polled in milliseconds.</p><p>The <code>listener</code> gets two arguments the current stat object and the previous
stat object:</p><pre><code class="language-js">fs.watchFile(&apos;message.text&apos;, (curr, prev) =&gt; {
  console.log(`the current mtime is: ${curr.mtime}`);
  console.log(`the previous mtime was: ${prev.mtime}`);
});
</code></pre><p>These stat objects are instances of <code>fs.Stat</code>.</p><p>To be notified when the file was modified, not just accessed, it is necessary
to compare <code>curr.mtime</code> and <code>prev.mtime</code>.</p><p>When an <code>fs.watchFile</code> operation results in an <code>ENOENT</code> error, it
will invoke the listener once, with all the fields zeroed (or, for dates, the
Unix Epoch). If the file is created later on, the listener will be called
again, with the latest stat objects. This is a change in functionality since
v0.10.</p><p>Using <a href="http://nodejs.cn/s/h2QY7Q" rel="nofollow"><code>fs.watch()</code></a> is more efficient than <code>fs.watchFile</code> and
<code>fs.unwatchFile</code>. <code>fs.watch</code> should be used instead of <code>fs.watchFile</code> and
<code>fs.unwatchFile</code> when possible.</p><p>When a file being watched by <code>fs.watchFile()</code> disappears and reappears,
then the <code>previousStat</code> reported in the second callback event (the file&apos;s
reappearance) will be the same as the <code>previousStat</code> of the first callback
event (its disappearance).</p><p>This happens when:</p><ul>
<li>the file is deleted, followed by a restore</li>
<li>the file is renamed and then renamed a second time back to its original name</li>
</ul></div>
          <div></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.write('<script src="http://nodejs.cn/api/fs/'&#32;+&#32;(location.port&#32;?&#32;''&#32;:&#32;'//static.nodejs.cn')&#32;+&#32;'/_static/js/api.js?1576756310153"><\/script>');
  </script>
</body>
</html>