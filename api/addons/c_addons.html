<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>C++ 插件 | Node.js API 文档</title>
  <link rel="icon" sizes="32x32" type="image/png" href="http://static.nodejs.cn/_static/img/favicon.png"><link rel="stylesheet" href="/api/api.css">
  <script>
    document.write('<link href="http://nodejs.cn/api/addons/'&#32;+&#32;(location.port?'':'//static.nodejs.cn')&#32;+&#32;'/_static/css/api.css?1576756291573" rel="stylesheet">')
  </script>
</head>
<body class="alt apidoc" id="page_api_item">
  <div id="api-section-addons">
    <div id="content" class="clearfix">
  
      <div id="column1" data-id="__ID__" class="interior">
        <header>
          <h1>C++ 插件</h1>
          <div id="gtoc">
            <ul>
              <li>v12.14.0</li>
              <li>
                <a href="../addons.html#addons_c_addons" name="toc">返回上层文档</a>
              </li>
              <li>
                <a href="https://github.com/nodejscn/node-api-cn/edit/master/addons/c_addons.md" rel="nofollow" target="_blank">提交修改</a>
              </li>
              <li>
                <a href="http://nodejs.cn/search" name="toc">搜索</a>
              </li>
            </ul>
          </div>
          <hr>
        </header>

        <div id="biz_item"></div>
  
        <div id="apicontent">
          <div id="content_left"><p>Node.js &#x63D2;&#x4EF6;&#x662F;&#x7528; C++ &#x7F16;&#x5199;&#x7684;&#x52A8;&#x6001;&#x94FE;&#x63A5;&#x5171;&#x4EAB;&#x5BF9;&#x8C61;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <a href="http://nodejs.cn/s/bVPMwV" rel="nofollow"><code>require()</code></a> &#x51FD;&#x6570;&#x52A0;&#x8F7D;&#x5230; Node.js &#x4E2D;&#xFF0C;&#x4E14;&#x50CF;&#x666E;&#x901A;&#x7684; Node.js &#x6A21;&#x5757;&#x4E00;&#x6837;&#x88AB;&#x4F7F;&#x7528;&#x3002;
&#x5B83;&#x4EEC;&#x4E3B;&#x8981;&#x7528;&#x4E8E;&#x4E3A;&#x8FD0;&#x884C;&#x5728; Node.js &#x4E2D;&#x7684; JavaScript &#x4E0E; C/C++ &#x5E93;&#x4E4B;&#x95F4;&#x63D0;&#x4F9B;&#x63A5;&#x53E3;&#x3002;</p><p>&#x5B9E;&#x73B0;&#x63D2;&#x4EF6;&#x6709;&#x4E09;&#x79CD;&#x9009;&#x62E9;&#xFF1A;N-API&#x3001;nan&#x3001;&#x6216;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x5185;&#x90E8;&#x7684; V8&#x3001;libuv &#x548C; Node.js &#x5E93;&#x3002;
&#x9664;&#x975E;&#x4F60;&#x9700;&#x8981;&#x76F4;&#x63A5;&#x8BBF;&#x95EE; N-API &#x672A;&#x516C;&#x5F00;&#x7684;&#x51FD;&#x6570;&#xFF0C;&#x5426;&#x5219;&#x8BF7;&#x4F7F;&#x7528; N-API&#x3002;
&#x6709;&#x5173; N-API &#x7684;&#x66F4;&#x591A;&#x4FE1;&#x606F;&#xFF0C;&#x53C2;&#x9605;<a href="http://nodejs.cn/s/eGYeBR" rel="nofollow">&#x5177;&#x6709; N-API &#x7684; C/C++ &#x63D2;&#x4EF6;</a>&#x3002;</p><p>&#x5F53;&#x4E0D;&#x4F7F;&#x7528; N-API &#x65F6;&#xFF0C;&#x5B9E;&#x73B0;&#x63D2;&#x4EF6;&#x5F88;&#x590D;&#x6742;&#xFF0C;&#x6D89;&#x53CA;&#x591A;&#x4E2A;&#x7EC4;&#x4EF6;&#x548C; API &#x7684;&#x77E5;&#x8BC6;&#xFF1A;</p><ul>
<li>
<p>V8&#xFF1A;Node.js &#x76EE;&#x524D;&#x7528;&#x4E8E;&#x63D0;&#x4F9B; JavaScript &#x5B9E;&#x73B0;&#x7684; C++ &#x5E93;&#x3002;
V8 &#x63D0;&#x4F9B;&#x4E86;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x3001;&#x8C03;&#x7528;&#x51FD;&#x6570;&#x7B49;&#x7684;&#x673A;&#x5236;&#x3002;
V8 &#x7684; API &#x6587;&#x6863;&#x4E3B;&#x8981;&#x5728; <code>v8.h</code> &#x5934;&#x6587;&#x4EF6;&#x4E2D;&#xFF08;Node.js &#x6E90;&#x4EE3;&#x7801;&#x6811;&#x4E2D;&#x7684; <code>deps/v8/include/v8.h</code>&#xFF09;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x5728;&#x67E5;&#x770B;<a href="http://nodejs.cn/s/FngRok" rel="nofollow">&#x5728;&#x7EBF;&#x6587;&#x6863;</a>&#x3002;</p>
</li>
<li>
<p><a href="http://nodejs.cn/s/QX7BGi" rel="nofollow">libuv</a>&#xFF1A;&#x5B9E;&#x73B0;&#x4E86; Node.js &#x7684;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x3001;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x3001;&#x4EE5;&#x53CA;&#x5E73;&#x53F0;&#x6240;&#x6709;&#x7684;&#x7684;&#x5F02;&#x6B65;&#x884C;&#x4E3A;&#x7684; C &#x5E93;&#x3002;
&#x5B83;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x8DE8;&#x5E73;&#x53F0;&#x7684;&#x62BD;&#x8C61;&#x5E93;&#xFF0C;&#x4F7F;&#x6240;&#x6709;&#x4E3B;&#x6D41;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x4E2D;&#x53EF;&#x4EE5;&#x50CF; POSIX &#x4E00;&#x6837;&#x8BBF;&#x95EE;&#x5E38;&#x7528;&#x7684;&#x7CFB;&#x7EDF;&#x4EFB;&#x52A1;&#xFF0C;&#x6BD4;&#x5982;&#x4E0E;&#x6587;&#x4EF6;&#x7CFB;&#x7EDF;&#x3001;socket&#x3001;&#x5B9A;&#x65F6;&#x5668;&#x3001;&#x4EE5;&#x53CA;&#x7CFB;&#x7EDF;&#x4E8B;&#x4EF6;&#x7684;&#x4EA4;&#x4E92;&#x3002;
libuv &#x8FD8;&#x63D0;&#x4F9B;&#x4E86;&#x4E00;&#x4E2A;&#x7C7B;&#x4F3C; POSIX &#x591A;&#x7EBF;&#x7A0B;&#x7684;&#x7EBF;&#x7A0B;&#x62BD;&#x8C61;&#xFF0C;&#x53EF;&#x88AB;&#x7528;&#x4E8E;&#x5F3A;&#x5316;&#x66F4;&#x590D;&#x6742;&#x7684;&#x9700;&#x8981;&#x8D85;&#x8D8A;&#x6807;&#x51C6;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x7684;&#x5F02;&#x6B65;&#x63D2;&#x4EF6;&#x3002;
&#x5EFA;&#x8BAE;&#x63D2;&#x4EF6;&#x5F00;&#x53D1;&#x8005;&#x591A;&#x601D;&#x8003;&#x5982;&#x4F55;&#x901A;&#x8FC7;&#x5728; libuv &#x7684;&#x975E;&#x963B;&#x585E;&#x7CFB;&#x7EDF;&#x64CD;&#x4F5C;&#x3001;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x3001;&#x6216;&#x81EA;&#x5B9A;&#x4E49;&#x7684; libuv &#x7EBF;&#x7A0B;&#x4E2D;&#x964D;&#x4F4E;&#x5DE5;&#x4F5C;&#x8D1F;&#x8F7D;&#x6765;&#x907F;&#x514D;&#x5728; I/O &#x6216;&#x5176;&#x4ED6;&#x65F6;&#x95F4;&#x5BC6;&#x96C6;&#x578B;&#x4EFB;&#x52A1;&#x4E2D;&#x963B;&#x585E;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x3002;</p>
</li>
<li>
<p>&#x5185;&#x7F6E;&#x7684; Node.js &#x5E93;&#x3002;Node.js &#x81EA;&#x8EAB;&#x516C;&#x5F00;&#x4E86;&#x63D2;&#x4EF6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684; C++ API&#xFF0C;&#x5176;&#x4E2D;&#x6700;&#x91CD;&#x8981;&#x7684;&#x662F; <code>node::ObjectWrap</code> &#x7C7B;&#x3002;</p>
</li>
<li>
<p>Node.js &#x5305;&#x542B;&#x4E86;&#x5176;&#x4ED6;&#x7684;&#x9759;&#x6001;&#x94FE;&#x63A5;&#x5E93;&#xFF0C;&#x5982; OpenSSL&#x3002;
&#x8FD9;&#x4E9B;&#x5E93;&#x4F4D;&#x4E8E; Node.js &#x6E90;&#x4EE3;&#x7801;&#x6811;&#x4E2D;&#x7684; <code>deps/</code> &#x76EE;&#x5F55;&#x3002;
&#x53EA;&#x6709; libuv&#x3001;OpenSSL&#x3001;V8 &#x548C; zlib &#x7B26;&#x53F7;&#x662F;&#x88AB; Node.js &#x6709;&#x76EE;&#x7684;&#x5730;&#x91CD;&#x65B0;&#x516C;&#x5F00;&#xFF0C;&#x5E76;&#x4E14;&#x53EF;&#x4EE5;&#x88AB;&#x63D2;&#x4EF6;&#x5728;&#x4E0D;&#x540C;&#x7A0B;&#x5EA6;&#x4E0A;&#x4F7F;&#x7528;&#x3002;
&#x66F4;&#x591A;&#x4FE1;&#x606F;&#x53EF;&#x67E5;&#x770B;<a href="http://nodejs.cn/s/8zW5PL" rel="nofollow">&#x94FE;&#x63A5;&#x5230; Node.js &#x81EA;&#x6709;&#x7684;&#x4F9D;&#x8D56;&#x9879;</a>&#x3002;</p>
</li>
</ul><p>&#x4EE5;&#x4E0B;&#x6240;&#x6709;&#x793A;&#x4F8B;&#x5747;&#x53EF;&#x4F9B;<a href="http://nodejs.cn/s/DPXXU9" rel="nofollow">&#x4E0B;&#x8F7D;</a>&#xFF0C;&#x5E76;&#x53EF;&#x7528;&#x4F5C;&#x5B66;&#x4E60;&#x63D2;&#x4EF6;&#x7684;&#x8D77;&#x70B9;&#x3002;</p></div>
          <div id="content_right"><p>Node.js Addons are dynamically-linked shared objects, written in C++, that
can be loaded into Node.js using the <a href="http://nodejs.cn/s/bVPMwV" rel="nofollow"><code>require()</code></a> function, and used
just as if they were an ordinary Node.js module. They are used primarily to
provide an interface between JavaScript running in Node.js and C/C++ libraries.</p><p>There are three options for implementing Addons: N-API, nan, or direct
use of internal V8, libuv and Node.js libraries. Unless you need direct
access to functionality which is not exposed by N-API, use N-API.
Refer to <a href="http://nodejs.cn/api/addons/n-api.html" rel="nofollow">C/C++ Addons with N-API</a> for more information on N-API.</p><p>When not using N-API, implementing Addons is complicated,
involving knowledge of several components and APIs:</p><ul>
<li>
<p>V8: the C++ library Node.js currently uses to provide the
JavaScript implementation. V8 provides the mechanisms for creating objects,
calling functions, etc. V8&apos;s API is documented mostly in the
<code>v8.h</code> header file (<code>deps/v8/include/v8.h</code> in the Node.js source
tree), which is also available <a href="http://nodejs.cn/s/FngRok" rel="nofollow">online</a>.</p>
</li>
<li>
<p><a href="http://nodejs.cn/s/QX7BGi" rel="nofollow">libuv</a>: The C library that implements the Node.js event loop, its worker
threads and all of the asynchronous behaviors of the platform. It also
serves as a cross-platform abstraction library, giving easy, POSIX-like
access across all major operating systems to many common system tasks, such
as interacting with the filesystem, sockets, timers, and system events. libuv
also provides a pthreads-like threading abstraction that may be used to
power more sophisticated asynchronous Addons that need to move beyond the
standard event loop. Addon authors are encouraged to think about how to
avoid blocking the event loop with I/O or other time-intensive tasks by
off-loading work via libuv to non-blocking system operations, worker threads
or a custom use of libuv&apos;s threads.</p>
</li>
<li>
<p>Internal Node.js libraries. Node.js itself exports C++ APIs that Addons can
use, the most important of which is the <code>node::ObjectWrap</code> class.</p>
</li>
<li>
<p>Node.js includes other statically linked libraries including OpenSSL. These
other libraries are located in the <code>deps/</code> directory in the Node.js source
tree. Only the libuv, OpenSSL, V8 and zlib symbols are purposefully
re-exported by Node.js and may be used to various extents by Addons. See
<a href="http://nodejs.cn/s/8zW5PL" rel="nofollow">Linking to Node.js&apos; own dependencies</a> for additional information.</p>
</li>
</ul><p>All of the following examples are available for <a href="http://nodejs.cn/s/DPXXU9" rel="nofollow">download</a> and may
be used as the starting-point for an Addon.</p></div>
          <div></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.write('<script src="http://nodejs.cn/api/addons/'&#32;+&#32;(location.port&#32;?&#32;''&#32;:&#32;'//static.nodejs.cn')&#32;+&#32;'/_static/js/api.js?1576756291573"><\/script>');
  </script>
</body>
</html>