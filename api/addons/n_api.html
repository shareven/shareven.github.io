<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>N-API | Node.js API 文档</title>
  <link rel="icon" sizes="32x32" type="image/png" href="http://static.nodejs.cn/_static/img/favicon.png"><link rel="stylesheet" href="/api/api.css">
  <script>
    document.write('<link href="http://nodejs.cn/api/addons/'&#32;+&#32;(location.port?'':'//static.nodejs.cn')&#32;+&#32;'/_static/css/api.css?1576756291613" rel="stylesheet">')
  </script>
</head>
<body class="alt apidoc" id="page_api_item">
  <div id="api-section-addons">
    <div id="content" class="clearfix">
  
      <div id="column1" data-id="__ID__" class="interior">
        <header>
          <h1>N-API</h1>
          <div id="gtoc">
            <ul>
              <li>v12.14.0</li>
              <li>
                <a href="../addons.html#addons_n_api" name="toc">返回上层文档</a>
              </li>
              <li>
                <a href="https://github.com/nodejscn/node-api-cn/edit/master/addons/n_api.md" rel="nofollow" target="_blank">提交修改</a>
              </li>
              <li>
                <a href="http://nodejs.cn/search" name="toc">搜索</a>
              </li>
            </ul>
          </div>
          <hr>
        </header>

        <div id="biz_item"></div>
  
        <div id="apicontent">
          <div id="content_left"><p></p><div class="api_stability api_stability_2"><a target="_blank" rel="nofollow" href="../documentation.html#documentation_stability_index">&#x7A33;&#x5B9A;&#x6027;: 2</a> - &#x7A33;&#x5B9A;</div><p></p><p>N-API &#x662F;&#x7528;&#x4E8E;&#x6784;&#x5EFA;&#x672C;&#x673A;&#x63D2;&#x4EF6;&#x7684;API&#x3002;
&#x5B83;&#x72EC;&#x7ACB;&#x4E8E;&#x5E95;&#x5C42; JavaScript &#x8FD0;&#x884C;&#x65F6;&#xFF08;&#x4F8B;&#x5982; V8&#xFF09;&#xFF0C;&#x5E76;&#x4F5C;&#x4E3A; Node.js &#x672C;&#x8EAB;&#x7684;&#x4E00;&#x90E8;&#x5206;&#x8FDB;&#x884C;&#x7EF4;&#x62A4;&#x3002;
&#x6B64; API &#x5C06;&#x662F;&#x8DE8; Node.js &#x7248;&#x672C;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E8C;&#x8FDB;&#x5236;&#x63A5;&#x53E3;&#xFF08;Application Binary Interface&#xFF0C;ABI&#xFF09;&#x7A33;&#x5B9A;&#x7248;&#x3002;
&#x5B83;&#x65E8;&#x5728;&#x5C06;&#x63D2;&#x4EF6;&#x4E0E;&#x5E95;&#x5C42; JavaScript &#x5F15;&#x64CE;&#x4E2D;&#x7684;&#x66F4;&#x6539;&#x9694;&#x79BB;&#x5F00;&#x6765;&#xFF0C;&#x5E76;&#x5141;&#x8BB8;&#x4E3A;&#x4E00;&#x4E2A;&#x7248;&#x672C;&#x7F16;&#x8BD1;&#x7684;&#x6A21;&#x5757;&#x5728;&#x66F4;&#x9AD8;&#x7248;&#x672C;&#x7684; Node.js &#x4E0A;&#x8FD0;&#x884C;&#x800C;&#x65E0;&#x9700;&#x91CD;&#x65B0;&#x7F16;&#x8BD1;&#x3002;
&#x63D2;&#x4EF6;&#x4F7F;&#x7528;&#x672C;&#x6587;&#x6863;&#x4E2D;&#x6982;&#x8FF0;&#x7684;&#x76F8;&#x540C;&#x65B9;&#x6CD5;/&#x5DE5;&#x5177;&#xFF08;node-gyp &#x7B49;&#xFF09;&#x6784;&#x5EFA;/&#x6253;&#x5305;&#x3002;
&#x552F;&#x4E00;&#x7684;&#x533A;&#x522B;&#x662F;&#x539F;&#x59CB;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x7684; API &#x96C6;&#x3002;
&#x4E0D;&#x4F7F;&#x7528; V8 &#x6216; <a href="http://nodejs.cn/s/TMQ3WL" rel="nofollow">Node.js &#x7684;&#x539F;&#x751F;&#x62BD;&#x8C61;</a>&#xFF0C;&#x800C;&#x662F;&#x4F7F;&#x7528; N-API &#x4E2D;&#x53EF;&#x7528;&#x7684;&#x529F;&#x80FD;&#x3002;</p><p>&#x521B;&#x5EFA;&#x548C;&#x7EF4;&#x62A4;&#x53D7;&#x76CA;&#x4E8E; N-API &#x63D0;&#x4F9B;&#x7684; ABI &#x7A33;&#x5B9A;&#x6027;&#x7684;&#x63D2;&#x4EF6;&#x4F1A;&#x5E26;&#x6765;&#x67D0;&#x4E9B;<a href="http://nodejs.cn/s/YyGDC2" rel="nofollow">&#x5B9E;&#x73B0;&#x7684;&#x6CE8;&#x610F;&#x4E8B;&#x9879;</a>&#x3002;</p><p>&#x8981;&#x5728;&#x4E0A;&#x9762;&#x7684; &#x201C;Hello world&#x201D; &#x793A;&#x4F8B;&#x4E2D;&#x4F7F;&#x7528; N-API&#xFF0C;&#x8BF7;&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x66FF;&#x6362; <code>hello.cc</code> &#x7684;&#x5185;&#x5BB9;&#x3002;
&#x6240;&#x6709;&#x5176;&#x4ED6;&#x8BF4;&#x660E;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;</p><pre><code class="language-cpp">// hello.cc using N-API
#include &lt;node_api.h&gt;

namespace demo {

napi_value Method(napi_env env, napi_callback_info args) {
  napi_value greeting;
  napi_status status;

  status = napi_create_string_utf8(env, &quot;world&quot;, NAPI_AUTO_LENGTH, &amp;greeting);
  if (status != napi_ok) return nullptr;
  return greeting;
}

napi_value init(napi_env env, napi_value exports) {
  napi_status status;
  napi_value fn;

  status = napi_create_function(env, nullptr, 0, Method, nullptr, &amp;fn);
  if (status != napi_ok) return nullptr;

  status = napi_set_named_property(env, exports, &quot;hello&quot;, fn);
  if (status != napi_ok) return nullptr;
  return exports;
}

NAPI_MODULE(NODE_GYP_MODULE_NAME, init)

}  // namespace demo
</code></pre><p>&#x53EF;&#x7528;&#x7684;&#x51FD;&#x6570;&#x548C;&#x4F7F;&#x7528;&#x6587;&#x6863;&#x8BF7;&#x53C2;&#x9605;<a href="http://nodejs.cn/s/eGYeBR" rel="nofollow">&#x5177;&#x6709; N-API &#x7684; C/C++ &#x63D2;&#x4EF6;</a>&#x3002;</p></div>
          <div id="content_right"><p></p><div class="api_stability api_stability_2"><a target="_blank" rel="nofollow" href="../documentation.html#documentation_stability_index">Stability: 2</a> - Stable</div><p></p><p>N-API is an API for building native Addons. It is independent from
the underlying JavaScript runtime (e.g. V8) and is maintained as part of
Node.js itself. This API will be Application Binary Interface (ABI) stable
across versions of Node.js. It is intended to insulate Addons from
changes in the underlying JavaScript engine and allow modules
compiled for one version to run on later versions of Node.js without
recompilation. Addons are built/packaged with the same approach/tools
outlined in this document (node-gyp, etc.). The only difference is the
set of APIs that are used by the native code. Instead of using the V8
or <a href="http://nodejs.cn/s/TMQ3WL" rel="nofollow">Native Abstractions for Node.js</a> APIs, the functions available
in the N-API are used.</p><p>Creating and maintaining an addon that benefits from the ABI stability
provided by N-API carries with it certain
<a href="http://nodejs.cn/api/addons/n-api.html#n_api_implications_of_abi_stability" rel="nofollow">implementation considerations</a>.</p><p>To use N-API in the above &quot;Hello world&quot; example, replace the content of
<code>hello.cc</code> with the following. All other instructions remain the same.</p><pre><code class="language-cpp">// hello.cc using N-API
#include &lt;node_api.h&gt;

namespace demo {

napi_value Method(napi_env env, napi_callback_info args) {
  napi_value greeting;
  napi_status status;

  status = napi_create_string_utf8(env, &quot;world&quot;, NAPI_AUTO_LENGTH, &amp;greeting);
  if (status != napi_ok) return nullptr;
  return greeting;
}

napi_value init(napi_env env, napi_value exports) {
  napi_status status;
  napi_value fn;

  status = napi_create_function(env, nullptr, 0, Method, nullptr, &amp;fn);
  if (status != napi_ok) return nullptr;

  status = napi_set_named_property(env, exports, &quot;hello&quot;, fn);
  if (status != napi_ok) return nullptr;
  return exports;
}

NAPI_MODULE(NODE_GYP_MODULE_NAME, init)

}  // namespace demo
</code></pre><p>The functions available and how to use them are documented in
<a href="http://nodejs.cn/api/addons/n-api.html" rel="nofollow">C/C++ Addons with N-API</a>.</p></div>
          <div></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.write('<script src="http://nodejs.cn/api/addons/'&#32;+&#32;(location.port&#32;?&#32;''&#32;:&#32;'//static.nodejs.cn')&#32;+&#32;'/_static/js/api.js?1576756291613"><\/script>');
  </script>
</body>
</html>