<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>'rejectionHandled' 事件 | Node.js API 文档</title>
  <link rel="icon" sizes="32x32" type="image/png" href="http://static.nodejs.cn/_static/img/favicon.png"><link rel="stylesheet" href="/api/api.css">
  <script>
    document.write('<link href="http://nodejs.cn/api/process/'&#32;+&#32;(location.port?'':'//static.nodejs.cn')&#32;+&#32;'/_static/css/api.css?1576756320957" rel="stylesheet">')
  </script>
</head>
<body class="alt apidoc" id="page_api_item">
  <div id="api-section-process">
    <div id="content" class="clearfix">
  
      <div id="column1" data-id="__ID__" class="interior">
        <header>
          <h1>'rejectionHandled' 事件</h1>
          <div id="gtoc">
            <ul>
              <li>v12.14.0</li>
              <li>
                <a href="../process.html#process_event_rejectionhandled" name="toc">返回上层文档</a>
              </li>
              <li>
                <a href="https://github.com/nodejscn/node-api-cn/edit/master/process/event_rejectionhandled.md" rel="nofollow" target="_blank">提交修改</a>
              </li>
              <li>
                <a href="http://nodejs.cn/search" name="toc">搜索</a>
              </li>
            </ul>
          </div>
          <hr>
        </header>

        <div id="biz_item"></div>
  
        <div id="apicontent">
          <div id="content_left"><div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v1.4.1</span>
</div><ul>
<li><code>promise</code> <a href="http://nodejs.cn/s/ri1kj8" target="_blank" rel="nofollow" class="type">&lt;Promise&gt;</a> &#x6700;&#x8FD1;&#x5904;&#x7406;&#x7684; Promise&#x3002;</li>
</ul><p>&#x6BCF;&#x5F53; <code>Promise</code> &#x88AB;&#x62D2;&#x7EDD;&#x5E76;&#x4E14;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x51FD;&#x6570;&#x9644;&#x52A0;&#x5230;&#x5B83;&#xFF08;&#x4F8B;&#x5982;&#xFF0C;&#x4F7F;&#x7528; <a href="http://nodejs.cn/s/gMRBfK" rel="nofollow"><code>promise.catch()</code></a>&#xFF09;&#x665A;&#x4E8E;&#x4E00;&#x4E2A; Node.js &#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x89E6;&#x53D1; <code>&apos;rejectionHandled&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p><p><code>Promise</code> &#x5BF9;&#x8C61;&#x4E4B;&#x524D;&#x5DF2;&#x7ECF;&#x5728; <code>&apos;unhandledRejection&apos;</code> &#x4E8B;&#x4EF6;&#x4E2D;&#x89E6;&#x53D1;&#xFF0C;&#x4F46;&#x5728;&#x5904;&#x7406;&#x8FC7;&#x7A0B;&#x4E2D;&#x83B7;&#x5F97;&#x4E86;&#x62D2;&#x7EDD;&#x5904;&#x7406;&#x51FD;&#x6570;&#x3002;</p><p><code>Promise</code> &#x94FE;&#x4E2D;&#x6CA1;&#x6709;&#x9876;&#x5C42;&#x7684;&#x6982;&#x5FF5;&#xFF0C;&#x603B;&#x662F;&#x53EF;&#x4EE5;&#x5904;&#x7406;&#x62D2;&#x7EDD;&#x3002;
&#x672C;&#x8D28;&#x4E0A;&#x81EA;&#x8EAB;&#x662F;&#x5F02;&#x6B65;&#x7684;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x672A;&#x6765;&#x7684;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x5904;&#x7406; <code>Promise</code> &#x62D2;&#x7EDD;&#xFF0C;&#x53EF;&#x80FD;&#x6BD4;&#x89E6;&#x53D1; <code>&apos;unhandledRejection&apos;</code> &#x4E8B;&#x4EF6;&#x6240;&#x9700;&#x7684;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x66F4;&#x665A;&#x3002;</p><p>&#x53E6;&#x4E00;&#x79CD;&#x8868;&#x8FF0;&#x7684;&#x65B9;&#x5F0F;&#x5C31;&#x662F;&#xFF0C;&#x4E0E;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x4E2D;&#x4E0D;&#x65AD;&#x589E;&#x957F;&#x7684;&#x672A;&#x5904;&#x7406;&#x5F02;&#x5E38;&#x5217;&#x8868;&#x4E0D;&#x540C;&#xFF0C;&#x4F7F;&#x7528; Promise &#x53EF;&#x80FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x4E0D;&#x65AD;&#x589E;&#x957F;&#x548C;&#x7F29;&#x5C0F;&#x7684;&#x672A;&#x5904;&#x7406;&#x62D2;&#x7EDD;&#x5217;&#x8868;&#x3002;</p><p>&#x5728;&#x540C;&#x6B65;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x5F53;&#x672A;&#x5904;&#x7406;&#x7684;&#x5F02;&#x5E38;&#x5217;&#x8868;&#x589E;&#x957F;&#x65F6;&#xFF0C;&#x4F1A;&#x89E6;&#x53D1; <code>&apos;uncaughtException&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p><p>&#x5728;&#x5F02;&#x6B65;&#x4EE3;&#x7801;&#x4E2D;&#xFF0C;&#x5F53;&#x672A;&#x5904;&#x7406;&#x7684;&#x62D2;&#x7EDD;&#x5217;&#x8868;&#x589E;&#x957F;&#x65F6;&#x4F1A;&#x89E6;&#x53D1; <code>&apos;unhandledRejection&apos;</code> &#x4E8B;&#x4EF6;&#xFF0C;&#x5E76;&#x4E14;&#x5F53;&#x672A;&#x5904;&#x7406;&#x7684;&#x62D2;&#x7EDD;&#x5217;&#x8868;&#x7F29;&#x5C0F;&#x65F6;&#x4F1A;&#x89E6;&#x53D1; <code>&apos;rejectionHandled&apos;</code> &#x4E8B;&#x4EF6;&#x3002;</p><pre><code class="language-js">const unhandledRejections = new Map();
process.on(&apos;unhandledRejection&apos;, (reason, promise) =&gt; {
  unhandledRejections.set(promise, reason);
});
process.on(&apos;rejectionHandled&apos;, (promise) =&gt; {
  unhandledRejections.delete(promise);
});
</code></pre><p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C; <code>unhandledRejections</code> &#x7684; <code>Map</code> &#x5C06;&#x968F;&#x7740;&#x65F6;&#x95F4;&#x7684;&#x63A8;&#x79FB;&#x800C;&#x589E;&#x957F;&#x548C;&#x7F29;&#x5C0F;&#xFF0C;&#x53CD;&#x6620;&#x51FA;&#x62D2;&#x7EDD;&#x5F00;&#x59CB;&#x672A;&#x5904;&#x7406;&#x7136;&#x540E;&#x88AB;&#x5904;&#x7406;&#x3002;
&#x53EF;&#x4EE5;&#x5B9A;&#x671F;&#x5730;&#xFF08;&#x8FD9;&#x5BF9;&#x53EF;&#x80FD;&#x957F;&#x65F6;&#x95F4;&#x8FD0;&#x884C;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x6700;&#x597D;&#xFF09;&#x6216;&#x8FDB;&#x7A0B;&#x9000;&#x51FA;&#x65F6;&#xFF08;&#x8FD9;&#x5BF9;&#x811A;&#x672C;&#x6765;&#x8BF4;&#x53EF;&#x80FD;&#x662F;&#x6700;&#x65B9;&#x4FBF;&#x7684;&#xFF09;&#x5728;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x4E2D;&#x8BB0;&#x5F55;&#x6B64;&#x7C7B;&#x9519;&#x8BEF;&#x3002;</p></div>
          <div id="content_right"><div class="api_metadata">
<span>Added in: v1.4.1</span>
</div><ul>
<li><code>promise</code> <a href="http://nodejs.cn/s/ri1kj8" target="_blank" rel="nofollow" class="type">&lt;Promise&gt;</a> The late handled promise.</li>
</ul><p>The <code>&apos;rejectionHandled&apos;</code> event is emitted whenever a <code>Promise</code> has been rejected
and an error handler was attached to it (using <a href="http://nodejs.cn/s/gMRBfK" rel="nofollow"><code>promise.catch()</code></a>, for
example) later than one turn of the Node.js event loop.</p><p>The <code>Promise</code> object would have previously been emitted in an
<code>&apos;unhandledRejection&apos;</code> event, but during the course of processing gained a
rejection handler.</p><p>There is no notion of a top level for a <code>Promise</code> chain at which rejections can
always be handled. Being inherently asynchronous in nature, a <code>Promise</code>
rejection can be handled at a future point in time &#x2014; possibly much later than
the event loop turn it takes for the <code>&apos;unhandledRejection&apos;</code> event to be emitted.</p><p>Another way of stating this is that, unlike in synchronous code where there is
an ever-growing list of unhandled exceptions, with Promises there can be a
growing-and-shrinking list of unhandled rejections.</p><p>In synchronous code, the <code>&apos;uncaughtException&apos;</code> event is emitted when the list of
unhandled exceptions grows.</p><p>In asynchronous code, the <code>&apos;unhandledRejection&apos;</code> event is emitted when the list
of unhandled rejections grows, and the <code>&apos;rejectionHandled&apos;</code> event is emitted
when the list of unhandled rejections shrinks.</p><pre><code class="language-js">const unhandledRejections = new Map();
process.on(&apos;unhandledRejection&apos;, (reason, promise) =&gt; {
  unhandledRejections.set(promise, reason);
});
process.on(&apos;rejectionHandled&apos;, (promise) =&gt; {
  unhandledRejections.delete(promise);
});
</code></pre><p>In this example, the <code>unhandledRejections</code> <code>Map</code> will grow and shrink over time,
reflecting rejections that start unhandled and then become handled. It is
possible to record such errors in an error log, either periodically (which is
likely best for long-running application) or upon process exit (which is likely
most convenient for scripts).</p></div>
          <div></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.write('<script src="http://nodejs.cn/api/process/'&#32;+&#32;(location.port&#32;?&#32;''&#32;:&#32;'//static.nodejs.cn')&#32;+&#32;'/_static/js/api.js?1576756320957"><\/script>');
  </script>
</body>
</html>