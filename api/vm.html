<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>vm | Node.js API &#x6587;&#x6863;</title>
  <link rel="icon" sizes="32x32" type="image/png" href="http://static.nodejs.cn/_static/img/favicon.png"><link rel="stylesheet" href="/api/api.css">
  <script>
    document.write('<link href="http://nodejs.cn/api/'&#32;+&#32;(location.port?'':'//static.nodejs.cn')&#32;+&#32;'/_static/css/api.css?1576756329672" rel="stylesheet">')
  </script>
  
</head>
<body class="alt apidoc" id="page_api">
  <div id="api-section-vm">
    <div id="content" class="clearfix">
      <div id="column2" class="interior">
        <div id="intro" class="interior">
          <a href="http://nodejs.cn/" rel="nofollow">
            Node.js &#x4E2D;&#x6587;&#x7F51;
          </a>
          <a href="index.html" rel="nofollow">
            v12.14.0
          </a>
          <div id="biz_nav"><a title="&#x5F00;&#x8BFE;&#x5427;" target="_blank" href="https://datayi.cn/w/LPd57bYo" rel="nofollow"><img></a></div>
        </div>
        <div class="line"></div>
        <ul>
<li><a href="assert.html" class="nav-assert" rel="nofollow">assert - &#x65AD;&#x8A00;</a></li>
<li><a href="async_hooks.html" class="nav-async_hooks" rel="nofollow">async_hooks - &#x5F02;&#x6B65;&#x94A9;&#x5B50;</a></li>
<li><a href="buffer.html" class="nav-buffer" rel="nofollow">Buffer - &#x7F13;&#x51B2;&#x5668;</a></li>
<li><a href="child_process.html" class="nav-child_process" rel="nofollow">child_process - &#x5B50;&#x8FDB;&#x7A0B;</a></li>
<li><a href="cluster.html" class="nav-cluster" rel="nofollow">cluster - &#x96C6;&#x7FA4;</a></li>
<li><a href="console.html" class="nav-console" rel="nofollow">console - &#x63A7;&#x5236;&#x53F0;</a></li>
<li><a href="crypto.html" class="nav-crypto" rel="nofollow">crypto - &#x52A0;&#x5BC6;</a></li>
<li><a href="debugger.html" class="nav-debugger" rel="nofollow">debugger - &#x8C03;&#x8BD5;&#x5668;</a></li>
<li><a href="dgram.html" class="nav-dgram" rel="nofollow">dgram - &#x6570;&#x636E;&#x62A5;</a></li>
<li><a href="dns.html" class="nav-dns" rel="nofollow">dns - &#x57DF;&#x540D;&#x670D;&#x52A1;&#x5668;</a></li>
<li><a href="domain.html" class="nav-domain" rel="nofollow">domain - &#x57DF;</a></li>
<li><a href="errors.html" class="nav-errors" rel="nofollow">Error - &#x5F02;&#x5E38;</a></li>
<li><a href="events.html" class="nav-events" rel="nofollow">events - &#x4E8B;&#x4EF6;&#x89E6;&#x53D1;&#x5668;</a></li>
<li><a href="fs.html" class="nav-fs" rel="nofollow">fs - &#x6587;&#x4EF6;&#x7CFB;&#x7EDF;</a></li>
<li><a href="globals.html" class="nav-globals" rel="nofollow">global - &#x5168;&#x5C40;&#x53D8;&#x91CF;</a></li>
<li><a href="http.html" class="nav-http" rel="nofollow">http - HTTP</a></li>
<li><a href="http2.html" class="nav-http2" rel="nofollow">http2 - HTTP/2</a></li>
<li><a href="https.html" class="nav-https" rel="nofollow">https - HTTPS</a></li>
<li><a href="inspector.html" class="nav-inspector" rel="nofollow">inspector - &#x68C0;&#x67E5;&#x5668;</a></li>
<li><a href="modules.html" class="nav-modules" rel="nofollow">module - &#x6A21;&#x5757;</a></li>
<li><a href="net.html" class="nav-net" rel="nofollow">net - &#x7F51;&#x7EDC;</a></li>
<li><a href="os.html" class="nav-os" rel="nofollow">os - &#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;</a></li>
<li><a href="path.html" class="nav-path" rel="nofollow">path - &#x8DEF;&#x5F84;</a></li>
<li><a href="perf_hooks.html" class="nav-perf_hooks" rel="nofollow">perf_hooks - &#x6027;&#x80FD;&#x94A9;&#x5B50;</a></li>
<li><a href="process.html" class="nav-process" rel="nofollow">process - &#x8FDB;&#x7A0B;</a></li>
<li><a href="punycode.html" class="nav-punycode" rel="nofollow">punycode - &#x57DF;&#x540D;&#x4EE3;&#x7801;</a></li>
<li><a href="querystring.html" class="nav-querystring" rel="nofollow">querystring - &#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;</a></li>
<li><a href="readline.html" class="nav-readline" rel="nofollow">readline - &#x9010;&#x884C;&#x8BFB;&#x53D6;</a></li>
<li><a href="repl.html" class="nav-repl" rel="nofollow">repl - &#x4EA4;&#x4E92;&#x5F0F;&#x89E3;&#x91CA;&#x5668;</a></li>
<li><a href="stream.html" class="nav-stream" rel="nofollow">stream - &#x6D41;</a></li>
<li><a href="string_decoder.html" class="nav-string_decoder" rel="nofollow">string_decoder - &#x5B57;&#x7B26;&#x4E32;&#x89E3;&#x7801;&#x5668;</a></li>
<li><a href="timers.html" class="nav-timers" rel="nofollow">timer - &#x5B9A;&#x65F6;&#x5668;</a></li>
<li><a href="tls.html" class="nav-tls" rel="nofollow">tls - &#x5B89;&#x5168;&#x4F20;&#x8F93;&#x5C42;</a></li>
<li><a href="tracing.html" class="nav-tracing" rel="nofollow">trace_events - &#x8DDF;&#x8E2A;&#x4E8B;&#x4EF6;</a></li>
<li><a href="tty.html" class="nav-tty" rel="nofollow">tty - &#x7EC8;&#x7AEF;</a></li>
<li><a href="url.html" class="nav-url" rel="nofollow">url - URL</a></li>
<li><a href="util.html" class="nav-util" rel="nofollow">util - &#x5B9E;&#x7528;&#x5DE5;&#x5177;</a></li>
<li><a href="v8.html" class="nav-v8" rel="nofollow">v8 - V8&#x5F15;&#x64CE;</a></li>
<li><a href="vm.html" class="nav-vm active" rel="nofollow">vm - &#x865A;&#x62DF;&#x673A;</a></li>
<li><a href="worker_threads.html" class="nav-worker_threads" rel="nofollow">worker_threads - &#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;</a></li>
<li><a href="zlib.html" class="nav-zlib" rel="nofollow">zlib - &#x538B;&#x7F29;</a></li>
</ul>
<div class="line"></div>
<ul>
<li><a href="documentation.html" class="nav-documentation" rel="nofollow">&#x5173;&#x4E8E;&#x672C;&#x6587;&#x6863;</a></li>
<li><a href="synopsis.html" class="nav-synopsis" rel="nofollow">&#x7528;&#x6CD5;&#x4E0E;&#x793A;&#x4F8B;</a></li>
<li><a href="addons.html" class="nav-addons" rel="nofollow">C++&#x63D2;&#x4EF6;</a></li>
<li><a href="n-api.html" class="nav-n-api" rel="nofollow">N-API</a></li>
<li><a href="cli.html" class="nav-cli" rel="nofollow">&#x547D;&#x4EE4;&#x884C;&#x9009;&#x9879;</a></li>
<li><a href="esm.html" class="nav-esm" rel="nofollow">ECMAScript &#x6A21;&#x5757;</a></li>
<li><a href="policy.html" class="nav-policy" rel="nofollow">&#x5B89;&#x5168;&#x7B56;&#x7565;</a></li>
<li><a href="report.html" class="nav-report" rel="nofollow">&#x8BCA;&#x65AD;&#x62A5;&#x8868;</a></li>
<li><a href="intl.html" class="nav-intl" rel="nofollow">&#x56FD;&#x9645;&#x5316;&#x652F;&#x6301;</a></li>
<li><a href="deprecations.html" class="nav-deprecations" rel="nofollow">&#x5E9F;&#x5F03;&#x7684; API</a></li>
</ul>
        
      </div>
  
      <div id="column1" data-id="vm" class="interior">
        <header>
          <h1>Node.js v12.14.0 &#x6587;&#x6863;</h1>
          <div id="gtoc">
            <ul>
              <li>
                <a href="index.html" name="toc">&#x8FD4;&#x56DE;&#x6587;&#x6863;&#x9996;&#x9875;</a>
              </li>
              <li>
                <a href="http://nodejs.cn/search" name="toc">&#x641C;&#x7D22;</a>
              </li>
              <!--  -->
            </ul>
          </div>
          <hr>
        </header>

        
        
        <div id="toc">
          <h2>&#x76EE;&#x5F55;</h2>
          <ul>
<li>
<p><a href="vm.html#vm_vm_executing_javascript">vm&#xFF08;&#x865A;&#x62DF;&#x673A;&#xFF09;</a></p>
<ul>
<li>
<p><a href="vm.html#vm_class_vm_script">vm.Script &#x7C7B;</a></p>
<ul>
<li><a href="vm.html#vm_constructor_new_vm_script_code_options">new vm.Script(code[, options])</a></li>
<li><a href="vm.html#vm_script_createcacheddata">script.createCachedData()</a></li>
<li><a href="vm.html#vm_script_runincontext_contextifiedsandbox_options">script.runInContext(contextifiedSandbox[, options])</a></li>
<li><a href="vm.html#vm_script_runinnewcontext_sandbox_options">script.runInNewContext([sandbox[, options]])</a></li>
<li><a href="vm.html#vm_script_runinthiscontext_options">script.runInThisContext([options])</a></li>
</ul>
</li>
<li>
<p><span class="stability_1"><a href="vm.html#vm_class_vm_sourcetextmodule">vm.SourceTextModule &#x7C7B;</a></span></p>
<ul>
<li><a href="vm.html#vm_constructor_new_vm_sourcetextmodule_code_options">new vm.SourceTextModule(code[, options])</a></li>
<li><a href="vm.html#vm_module_dependencyspecifiers">module.dependencySpecifiers</a></li>
<li><a href="vm.html#vm_module_error">module.error</a></li>
<li><a href="vm.html#vm_module_evaluate_options">module.evaluate([options])</a></li>
<li><a href="vm.html#vm_module_link_linker">module.link(linker)</a></li>
<li><a href="vm.html#vm_module_namespace">module.namespace</a></li>
<li><a href="vm.html#vm_module_status">module.status</a></li>
<li><a href="vm.html#vm_module_identifier">module.identifier</a></li>
</ul>
</li>
<li><a href="vm.html#vm_vm_compilefunction_code_params_options">vm.compileFunction(code[, params[, options]])</a></li>
<li><a href="vm.html#vm_vm_createcontext_sandbox_options">vm.createContext([sandbox[, options]])</a></li>
<li><a href="vm.html#vm_vm_iscontext_sandbox">vm.isContext(sandbox)</a></li>
<li><a href="vm.html#vm_vm_runincontext_code_contextifiedsandbox_options">vm.runInContext(code, contextifiedSandbox[, options])</a></li>
<li><a href="vm.html#vm_vm_runinnewcontext_code_sandbox_options">vm.runInNewContext(code[, sandbox[, options]])</a></li>
<li><a href="vm.html#vm_vm_runinthiscontext_code_options">vm.runInThisContext(code[, options])</a></li>
<li><a href="vm.html#vm_example_running_an_http_server_within_a_vm">&#x793A;&#x4F8B;&#xFF1A;&#x5728; VM &#x4E2D;&#x8FD0;&#x884C; HTTP Server</a></li>
<li><a href="vm.html#vm_what_does_it_mean_to_contextify_an_object">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x610F;&#x5473;&#x7740;&#x4EC0;&#x4E48;&#xFF1F;</a></li>
<li><a href="vm.html#vm_timeout_limitations_when_using_process_nexttick_promises_and_queuemicrotask">&#x5F53;&#x4F7F;&#x7528; process.nextTick()&#x3001;Promise &#x548C; queueMicrotask() &#x65F6;&#x7684;&#x8D85;&#x65F6;&#x9650;&#x5236;</a></li>
</ul>
</li>
</ul>
        </div>

        <!-- <div id="biz_content">
          <a href="http://www.tp-shop.cn/index.php?http_referer=node" target="_blank">
            <img src="//static.nodejs.cn/_static/img/ad/api_content_tpshop.jpg" />
          </a>
        </div> -->
  
        <div id="apicontent">
          <h1>vm&#xFF08;&#x865A;&#x62DF;&#x673A;&#xFF09;<span><a class="mark" href="vm.html#vm_vm_executing_javascript" id="vm_vm_executing_javascript">#</a></span></h1><p class="tip_wrap"><a href="vm/vm_executing_javascript.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/vm_executing_javascript.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<p></p><div class="api_stability api_stability_2"><a target="_blank" rel="nofollow" href="documentation.html#documentation_stability_index">&#x7A33;&#x5B9A;&#x6027;: 2</a> - &#x7A33;&#x5B9A;</div><p></p>
<!--name=vm-->
<p><code>vm</code> &#x6A21;&#x5757;&#x63D0;&#x4F9B;&#x4E86;&#x5728; V8 &#x865A;&#x62DF;&#x673A;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7F16;&#x8BD1;&#x548C;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#x7684;&#x4E00;&#x7CFB;&#x5217; API&#x3002;<code>vm</code> &#x6A21;&#x5757;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x5B89;&#x5168;&#x7684;&#x865A;&#x62DF;&#x673A;&#x3002;&#x4E0D;&#x8981;&#x7528;&#x5B83;&#x6765;&#x8FD0;&#x884C;&#x4E0D;&#x53D7;&#x4FE1;&#x4EFB;&#x7684;&#x4EE3;&#x7801;&#x3002;&#x5728;&#x8FD9;&#x4E9B;&#x6587;&#x6863;&#x4E2D; &quot;sanbox&quot; &#x8FD9;&#x4E2A;&#x672F;&#x8BED;&#x4EC5;&#x4EC5;&#x662F;&#x4E3A;&#x4E86;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5E76;&#x4E0D;&#x63D0;&#x4F9B;&#x4EFB;&#x4F55;&#x5B89;&#x5168;&#x4FDD;&#x969C;&#x3002;</p>
<p>JavaScript &#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x88AB;&#x7F16;&#x8BD1;&#x5E76;&#x7ACB;&#x5373;&#x8FD0;&#x884C;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x7F16;&#x8BD1;&#x3001;&#x4FDD;&#x5B58;&#xFF0C;&#x4EE5;&#x540E;&#x518D;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x4E00;&#x4E2A;&#x5E38;&#x89C1;&#x7684;&#x573A;&#x666F;&#x662F;&#x5728;&#x6C99;&#x76D2;&#x4E2D;&#x8FD0;&#x884C;&#x4EE3;&#x7801;&#x3002;&#x6C99;&#x76D2;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x4E0D;&#x540C;&#x7684; V8 &#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x8FD9;&#x610F;&#x5473;&#x7740;&#x5B83;&#x5177;&#x6709;&#x4E0E;&#x5176;&#x4F59;&#x4EE3;&#x7801;&#x4E0D;&#x540C;&#x7684;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x4E00;&#x4E2A;&#x6C99;&#x7BB1;&#x5BF9;&#x8C61;&#x6765;&#x63D0;&#x4F9B;&#x4E0A;&#x4E0B;&#x6587;&#x3002;&#x6C99;&#x76D2;&#x4EE3;&#x7801;&#x5C06;&#x6C99;&#x76D2;&#x4E2D;&#x7684;&#x4EFB;&#x4F55;&#x5C5E;&#x6027;&#x89C6;&#x4E3A;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#x3002;&#x7531;&#x6C99;&#x76D2;&#x4EE3;&#x7801;&#x5F15;&#x8D77;&#x7684;&#x4EFB;&#x4F55;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x7684;&#x66F4;&#x6539;&#x90FD;&#x5C06;&#x53CD;&#x6620;&#x5230;&#x6C99;&#x76D2;&#x5BF9;&#x8C61;&#x4E2D;&#x3002;</p>
<pre><code class="language-js">const vm = require(&apos;vm&apos;);

const x = 1;

const sandbox = { x: 2 };
vm.createContext(sandbox); // &#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;&#x4E00;&#x4E2A;&#x6C99;&#x76D2;&#x3002;

const code = &apos;x += 40; var y = 17;&apos;;
// `x` and `y` &#x662F;&#x6C99;&#x76D2;&#x73AF;&#x5883;&#x4E2D;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x3002;
// &#x6700;&#x521D;&#xFF0C;x &#x7684;&#x503C;&#x4E3A; 2&#xFF0C;&#x56E0;&#x4E3A;&#x8FD9;&#x662F; sandbox.x &#x7684;&#x503C;&#x3002;
vm.runInContext(code, sandbox);

console.log(sandbox.x); // 42
console.log(sandbox.y); // 17

console.log(x); // 1; y &#x6CA1;&#x6709;&#x5B9A;&#x4E49;&#x3002;
</code></pre>
<h2>vm.Script &#x7C7B;<span><a class="mark" href="vm.html#vm_class_vm_script" id="vm_class_vm_script">#</a></span></h2><p class="tip_wrap"><a href="vm/class_vm_script.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/class_vm_script.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span>
</div>
<p> <code>vm.Script</code>&#x7C7B;&#x578B;&#x7684;&#x5B9E;&#x4F8B;&#x5305;&#x542B;&#x82E5;&#x5E72;&#x9884;&#x7F16;&#x8BD1;&#x7684;&#x811A;&#x672C;&#xFF0C;&#x8FD9;&#x4E9B;&#x811A;&#x672C;&#x80FD;&#x591F;&#x5728;&#x7279;&#x5B9A;&#x7684;&#x6C99;&#x7BB1;&#xFF08;&#x6216;&#x8005;&#x4E0A;&#x4E0B;&#x6587;&#xFF09;&#x4E2D;&#x88AB;&#x8FD0;&#x884C;&#x3002;</p>
<h3>new vm.Script(code[, options])<span><a class="mark" href="vm.html#vm_constructor_new_vm_script_code_options" id="vm_constructor_new_vm_script_code_options">#</a></span></h3><p class="tip_wrap"><a href="vm/constructor_new_vm_script_code_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/constructor_new_vm_script_code_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v10.6.0</td>
<td><p>The <code>produceCachedData</code> is deprecated in favour of <code>script.createCachedData()</code></p></td></tr>
<tr><td>v5.7.0</td>
<td><p>The <code>cachedData</code> and <code>produceCachedData</code> options are supported now.</p></td></tr>
<tr><td>v0.3.1</td>
<td><p><span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span></p></td></tr>
</tbody></table>
</details>
</div>
<ul>
<li><code>code</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x9700;&#x8981;&#x88AB;&#x89E3;&#x6790;&#x7684; JavaScript &#x4EE3;&#x7801;&#x3002;</li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> | <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a></p>
<ul>
<li><code>filename</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5B9A;&#x4E49;&#x4F9B;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;evalmachine.&lt;anonymous&gt;&apos;</code>&#x3002;</li>
<li><code>lineOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x663E;&#x793A;&#x7684;&#x884C;&#x53F7;&#x504F;&#x79FB;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>columnOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x663E;&#x793A;&#x7684;&#x5217;&#x53F7;&#x504F;&#x79FB;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>cachedData</code> <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="nofollow" class="type">&lt;Buffer&gt;</a> | <a href="http://nodejs.cn/s/oh3CkV" target="_blank" rel="nofollow" class="type">&lt;TypedArray&gt;</a> | <a href="http://nodejs.cn/s/yCdVkD" target="_blank" rel="nofollow" class="type">&lt;DataView&gt;</a> &#x4E3A;&#x6E90;&#x7801;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x5B58;&#x6709; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684; <code>Buffer</code>&#x3001; <code>TypedArray</code> &#x6216; <code>TypedArray</code>&#x3002;
&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x4E86;&#xFF0C;&#x5219; <code>cachedDataRejected</code> &#x7684;&#x503C;&#x5C06;&#x4F1A;&#x88AB;&#x8BBE;&#x4E3A;&#x8981;&#x4E48;&#x4E3A; <code>true</code> &#x8981;&#x4E48;&#x4E3A; <code>false</code>&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E; v8 &#x5F15;&#x64CE;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x63A5;&#x53D7;&#x72B6;&#x51B5;&#x3002;</li>
<li><code>produceCachedData</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x4E14; <code>cachedData</code> &#x4E0D;&#x5B58;&#x5728;&#x7684;&#x65F6;&#x5019;&#xFF0C;V8 &#x5C06;&#x4F1A;&#x8BD5;&#x56FE;&#x4E3A; <code>code</code> &#x751F;&#x6210;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x3002;
&#x4E00;&#x65E6;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x4E00;&#x4E2A;&#x6709; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684; <code>Buffer</code> &#x5C06;&#x4F1A;&#x88AB;&#x751F;&#x6210;&#x548C;&#x50A8;&#x5B58;&#x5728;&#x8FD4;&#x56DE;&#x7684; <code>vm.Script</code> &#x5B9E;&#x4F8B;&#x7684; <code>cachedData</code> &#x5C5E;&#x6027;&#x91CC;&#x3002;
<code>cachedDataProduced</code> &#x7684;&#x503C;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; <code>true</code> &#x6216;&#x8005; <code>false</code>&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x662F;&#x5426;&#x88AB;&#x6210;&#x529F;&#x751F;&#x6210;&#x3002;
&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>script.createCachedData()</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li>
<p><code>importModuleDynamically</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a> &#x5728;&#x8C03;&#x7528; <code>import()</code> &#x65F6;&#x8BC4;&#x4F30;&#x6B64;&#x6A21;&#x5757;&#x671F;&#x95F4;&#x8C03;&#x7528;&#x3002;
&#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x5219;&#x5BF9; <code>import()</code> &#x7684;&#x8C03;&#x7528;&#x5C06;&#x62D2;&#x7EDD; <a href="http://nodejs.cn/s/fqox4U" rel="nofollow"><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code></a>&#x3002;
&#x6B64;&#x9009;&#x9879;&#x662F; <code>--experimental-modules</code> &#x6807;&#x5FD7;&#x7684;&#x5B9E;&#x9A8C; API &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4E0D;&#x5E94;&#x88AB;&#x89C6;&#x4E3A;&#x7A33;&#x5B9A;&#x3002;</p>
<ul>
<li><code>specifier</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x4F20;&#x7ED9; <code>import()</code> &#x7684;&#x8BF4;&#x660E;&#x7B26;&#x3002;</li>
<li><code>module</code> <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a></li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/uwQPrn" target="_blank" rel="nofollow" class="type">&lt;Module Namespace Object&gt;</a> | <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a> &#x8FD4;&#x56DE; <code>vm.SourceTextModule</code> &#x4EE5;&#x5229;&#x7528;&#x9519;&#x8BEF;&#x8DDF;&#x8E2A;&#xFF0C;&#x5E76;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x5305;&#x542B; <code>then</code> &#x51FD;&#x6570;&#x5BFC;&#x51FA;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x95EE;&#x9898;&#x3002;</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>&#x5982;&#x679C; <code>options</code> &#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5219;&#x5B83;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x540D;&#x3002;</p>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684; <code>vm.Script</code> &#x5BF9;&#x8C61;&#x53EA;&#x7F16;&#x8BD1; <code>code</code> &#x4F46;&#x4E0D;&#x4F1A;&#x6267;&#x884C;&#x5B83;&#x3002;
&#x7F16;&#x8BD1;&#x8FC7;&#x7684; <code>vm.Script</code> &#x6B64;&#x540E;&#x53EF;&#x4EE5;&#x88AB;&#x591A;&#x6B21;&#x6267;&#x884C;&#x3002;
<code>code</code> &#x662F;&#x4E0D;&#x7ED1;&#x5B9A;&#x4E8E;&#x4EFB;&#x4F55;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#x7684;&#xFF0C;&#x76F8;&#x53CD;&#xFF0C;&#x5B83;&#x4EC5;&#x4EC5;&#x7ED1;&#x5B9A;&#x4E8E;&#x6BCF;&#x6B21;&#x6267;&#x884C;&#x5B83;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<h3>script.createCachedData()<span><a class="mark" href="vm.html#vm_script_createcacheddata" id="vm_script_createcacheddata">#</a></span></h3><p class="tip_wrap"><a href="vm/script_createcacheddata.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/script_createcacheddata.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v10.6.0</span>
</div>
<ul>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="nofollow" class="type">&lt;Buffer&gt;</a></li>
</ul>
<p>&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x53EF;&#x4EE5;&#x88AB; Script &#x6784;&#x9020;&#x51FD;&#x6570;&#x4E2D; <code>cachedData</code> &#x9009;&#x9879;&#x4F7F;&#x7528;&#x7684;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x3002;&#x8FD4;&#x56DE; Buffer&#x3002;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x65F6;&#x5019;&#x4E0D;&#x9650;&#x6B21;&#x6570;&#x5730;&#x8C03;&#x7528;&#x8BE5;&#x65B9;&#x6CD5;&#x3002;</p>
<pre><code class="language-js">const script = new vm.Script(`
function add(a, b) {
  return a + b;
}

const x = add(1, 2);
`);

const cacheWithoutX = script.createCachedData();

script.runInThisContext();

const cacheWithX = script.createCachedData();
</code></pre>
<h3>script.runInContext(contextifiedSandbox[, options])<span><a class="mark" href="vm.html#vm_script_runincontext_contextifiedsandbox_options" id="vm_script_runincontext_contextifiedsandbox_options">#</a></span></h3><p class="tip_wrap"><a href="vm/script_runincontext_contextifiedsandbox_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/script_runincontext_contextifiedsandbox_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v6.3.0</td>
<td><p>The <code>breakOnSigint</code> option is supported now.</p></td></tr>
<tr><td>v0.3.1</td>
<td><p><span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span></p></td></tr>
</tbody></table>
</details>
</div>
<ul>
<li><code>contextifiedSandbox</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> &#x7531; <code>vm.createContext()</code> &#x8FD4;&#x56DE;&#x7684;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x7684;&#x5BF9;&#x8C61;&#x3002;</li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>displayErrors</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5047;&#x5982;&#x5728;&#x89E3;&#x6790;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x751F;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#xFF0C;&#x5F15;&#x8D77;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x5C06;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>timeout</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> &#x5B9A;&#x4E49;&#x5728;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x6B64; <code>code</code> &#x88AB;&#x5141;&#x8BB8;&#x6267;&#x884C;&#x7684;&#x6700;&#x5927;&#x6BEB;&#x79D2;&#x6570;&#x3002;&#x5047;&#x5982;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#x3002;&#x8BE5;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E25;&#x683C;&#x6B63;&#x6574;&#x6570;&#x3002;</li>
<li><code>breakOnSigint</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x82E5;&#x503C;&#x4E3A; <code>true</code>&#xFF0C;&#x5F53;&#x6536;&#x5230; <code>SIGINT</code> (Ctrl+C)&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x3002;
&#x6B64;&#x5916;&#xFF0C;&#x901A;&#x8FC7; <code>process.on(&apos;SIGINT&apos;)</code> &#x65B9;&#x6CD5;&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x6D88;&#x606F;&#x54CD;&#x5E94;&#x673A;&#x5236;&#x5728;&#x4EE3;&#x7801;&#x88AB;&#x6267;&#x884C;&#x65F6;&#x4F1A;&#x88AB;&#x5C4F;&#x853D;&#xFF0C;&#x4F46;&#x4EE3;&#x7801;&#x88AB;&#x7EC8;&#x6B62;&#x540E;&#x4F1A;&#x88AB;&#x6062;&#x590D;&#x3002;&#x5982;&#x679C;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a> &#x4F1A;&#x88AB;&#x629B;&#x51FA;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
</ul>
</li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="nofollow" class="type">&lt;any&gt;</a> &#x811A;&#x672C;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;&#x3002;</li>
</ul>
<p>&#x5728;&#x6307;&#x5B9A;&#x7684; <code>contextifiedSandbox</code> &#x4E2D;&#x6267;&#x884C; <code>vm.Script</code> &#x5BF9;&#x8C61;&#x4E2D;&#x88AB;&#x7F16;&#x8BD1;&#x540E;&#x7684;&#x4EE3;&#x7801;&#x5E76;&#x8FD4;&#x56DE;&#x5176;&#x7ED3;&#x679C;&#x3002;&#x88AB;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x4F5C;&#x7528;&#x57DF;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x7684;&#x4F8B;&#x5B50;&#x4F1A;&#x7F16;&#x8BD1;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x8BE5;&#x4EE3;&#x7801;&#x4F1A;&#x9012;&#x589E;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x7ED9;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x3002;&#x540C;&#x65F6;&#x8BE5;&#x4EE3;&#x7801;&#x88AB;&#x7F16;&#x8BD1;&#x540E;&#x4F1A;&#x88AB;&#x591A;&#x6B21;&#x6267;&#x884C;&#x3002;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4F1A;&#x88AB;&#x7F6E;&#x4E8E; <code>sandbox</code> &#x5BF9;&#x8C61;&#x5185;&#x3002;</p>
<pre><code class="language-js">const util = require(&apos;util&apos;);
const vm = require(&apos;vm&apos;);

const sandbox = {
  animal: &apos;cat&apos;,
  count: 2
};

const script = new vm.Script(&apos;count += 1; name = &quot;kitty&quot;;&apos;);

const context = vm.createContext(sandbox);
for (let i = 0; i &lt; 10; ++i) {
  script.runInContext(context);
}

console.log(util.inspect(sandbox));

// { animal: &apos;cat&apos;, count: 12, name: &apos;kitty&apos; }
</code></pre>
<p>&#x4F7F;&#x7528; <code>timeout</code> &#x6216;&#x8005; <code>breakOnSigint</code> &#x9009;&#x9879;&#x4F1A;&#x5BFC;&#x81F4;&#x82E5;&#x5E72;&#x65B0;&#x7684;&#x4E8B;&#x4EF6;&#x5FAA;&#x73AF;&#x4EE5;&#x53CA;&#x5BF9;&#x5E94;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x8FD9;&#x6709;&#x4E00;&#x4E2A;&#x975E;&#x96F6;&#x7684;&#x6027;&#x80FD;&#x6D88;&#x8017;&#x3002;</p>
<h3>script.runInNewContext([sandbox[, options]])<span><a class="mark" href="vm.html#vm_script_runinnewcontext_sandbox_options" id="vm_script_runinnewcontext_sandbox_options">#</a></span></h3><p class="tip_wrap"><a href="vm/script_runinnewcontext_sandbox_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/script_runinnewcontext_sandbox_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v10.0.0</td>
<td><p>The <code>contextCodeGeneration</code> option is supported now.</p></td></tr>
<tr><td>v6.3.0</td>
<td><p>The <code>breakOnSigint</code> option is supported now.</p></td></tr>
<tr><td>v0.3.1</td>
<td><p><span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span></p></td></tr>
</tbody></table>
</details>
</div>
<ul>
<li><code>sandbox</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> &#x4E00;&#x4E2A;&#x5C06;&#x4F1A;&#x88AB;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5982;&#x679C;&#x662F; <code>undefined</code>, &#x5219;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x3002;</li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>displayErrors</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5047;&#x5982;&#x5728;&#x89E3;&#x6790;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x751F;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#xFF0C;&#x5F15;&#x8D77;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x5C06;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>timeout</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> &#x5B9A;&#x4E49;&#x5728;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x6B64; <code>code</code> &#x88AB;&#x5141;&#x8BB8;&#x6267;&#x884C;&#x7684;&#x6700;&#x5927;&#x6BEB;&#x79D2;&#x6570;&#x3002;&#x5047;&#x5982;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#x3002;&#x8BE5;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E25;&#x683C;&#x6B63;&#x6574;&#x6570;&#x3002;</li>
<li><code>breakOnSigint</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x82E5;&#x503C;&#x4E3A; <code>true</code>&#xFF0C;&#x5F53;&#x6536;&#x5230; <code>SIGINT</code> (Ctrl+C)&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x3002;
&#x6B64;&#x5916;&#xFF0C;&#x901A;&#x8FC7; <code>process.on(&apos;SIGINT&apos;)</code> &#x65B9;&#x6CD5;&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x6D88;&#x606F;&#x54CD;&#x5E94;&#x673A;&#x5236;&#x5728;&#x4EE3;&#x7801;&#x88AB;&#x6267;&#x884C;&#x65F6;&#x4F1A;&#x88AB;&#x5C4F;&#x853D;&#xFF0C;&#x4F46;&#x4EE3;&#x7801;&#x88AB;&#x7EC8;&#x6B62;&#x540E;&#x4F1A;&#x88AB;&#x6062;&#x590D;&#x3002;&#x5982;&#x679C;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a> &#x4F1A;&#x88AB;&#x629B;&#x51FA;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li><code>contextName</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x65B0;&#x521B;&#x5EFA;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4EBA;&#x7C7B;&#x53EF;&#x8BFB;&#x540D;&#x79F0;&#x3002; <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;VM Context i&apos;</code>&#xFF0C;&#x5176;&#x4E2D; <code>i</code> &#x662F;&#x521B;&#x5EFA;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x5347;&#x5E8F;&#x6570;&#x5B57;&#x7D22;&#x5F15;&#x3002;</li>
<li><code>contextOrigin</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5BF9;&#x5E94;&#x4E8E;&#x65B0;&#x521B;&#x5EFA;&#x7528;&#x4E8E;&#x663E;&#x793A;&#x76EE;&#x7684;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;<a href="http://nodejs.cn/s/SYyZxA" rel="nofollow">&#x539F;&#x70B9;</a>&#x3002;
&#x539F;&#x70B9;&#x5E94;&#x683C;&#x5F0F;&#x5316;&#x4E3A;&#x7C7B;&#x4F3C;&#x4E00;&#x4E2A; URL&#xFF0C;&#x4F46;&#x53EA;&#x5305;&#x542B;&#x534F;&#x8BAE;&#xFF0C;&#x4E3B;&#x673A;&#x548C;&#x7AEF;&#x53E3;&#xFF08;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF09;&#xFF0C;&#x4F8B;&#x5982; <a href="http://nodejs.cn/s/vzpPx2" rel="nofollow"><code>URL</code></a> &#x5BF9;&#x8C61;&#x7684; <a href="http://nodejs.cn/s/rpuY73" rel="nofollow"><code>url.origin</code></a> &#x5C5E;&#x6027;&#x7684;&#x503C;&#x3002; &#x6700;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6B64;&#x5B57;&#x7B26;&#x4E32;&#x5E94;&#x7701;&#x7565;&#x5C3E;&#x90E8;&#x659C;&#x6760;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x8868;&#x793A;&#x8DEF;&#x5F84;&#x3002; <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;&apos;</code>&#x3002;</li>
<li>
<p><code>contextCodeGeneration</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>strings</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A; <code>false</code>&#xFF0C;&#x5219;&#x5BF9; <code>eval</code> &#x6216;&#x51FD;&#x6570;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;<code>Function</code>&#x3001; <code>GeneratorFunction</code> &#x7B49;&#xFF09;&#x7684;&#x4EFB;&#x4F55;&#x8C03;&#x7528;&#x90FD;&#x5C06;&#x629B;&#x51FA; <code>EvalError</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>wasm</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A; <code>false</code>&#xFF0C;&#x5219;&#x4EFB;&#x4F55;&#x7F16;&#x8BD1; WebAssembly &#x6A21;&#x5757;&#x7684;&#x5C1D;&#x8BD5;&#x90FD;&#x5C06;&#x629B;&#x51FA; <code>WebAssembly.CompileError</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
</ul>
</li>
</ul>
</li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="nofollow" class="type">&lt;any&gt;</a> &#x811A;&#x672C;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;&#x3002;</li>
</ul>
<p>&#x9996;&#x5148;&#x7ED9;&#x6307;&#x5B9A;&#x7684; <code>sandbox</code> &#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x9694;&#x79BB;&#x7684;&#x4E0A;&#x4E0B;&#x6587;, &#x518D;&#x5728;&#x6B64;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x6267;&#x884C; <code>vm.Script</code> &#x4E2D;&#x88AB;&#x7F16;&#x8BD1;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x6700;&#x540E;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x4F5C;&#x7528;&#x57DF;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x7684;&#x4F8B;&#x5B50;&#x4F1A;&#x7F16;&#x8BD1;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x8BE5;&#x4EE3;&#x7801;&#x4F1A;&#x9012;&#x589E;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x7ED9;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x3002;&#x540C;&#x65F6;&#x8BE5;&#x4EE3;&#x7801;&#x88AB;&#x7F16;&#x8BD1;&#x540E;&#x4F1A;&#x88AB;&#x591A;&#x6B21;&#x6267;&#x884C;&#x3002;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4F1A;&#x88AB;&#x7F6E;&#x4E8E;&#x5404;&#x4E2A;&#x72EC;&#x7ACB;&#x7684; <code>sandbox</code> &#x5BF9;&#x8C61;&#x5185;&#x3002;</p>
<pre><code class="language-js">const util = require(&apos;util&apos;);
const vm = require(&apos;vm&apos;);

const script = new vm.Script(&apos;globalVar = &quot;set&quot;&apos;);

const sandboxes = [{}, {}, {}];
sandboxes.forEach((sandbox) =&gt; {
  script.runInNewContext(sandbox);
});

console.log(util.inspect(sandboxes));

// [{ globalVar: &apos;set&apos; }, { globalVar: &apos;set&apos; }, { globalVar: &apos;set&apos; }]
</code></pre>
<h3>script.runInThisContext([options])<span><a class="mark" href="vm.html#vm_script_runinthiscontext_options" id="vm_script_runinthiscontext_options">#</a></span></h3><p class="tip_wrap"><a href="vm/script_runinthiscontext_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/script_runinthiscontext_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span>
</div>
<ul>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>displayErrors</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5047;&#x5982;&#x5728;&#x89E3;&#x6790;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x751F;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#xFF0C;&#x5F15;&#x8D77;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x5C06;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>timeout</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> &#x5B9A;&#x4E49;&#x5728;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x6B64; <code>code</code> &#x88AB;&#x5141;&#x8BB8;&#x6267;&#x884C;&#x7684;&#x6700;&#x5927;&#x6BEB;&#x79D2;&#x6570;&#x3002;&#x5047;&#x5982;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#x3002;&#x8BE5;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E25;&#x683C;&#x6B63;&#x6574;&#x6570;&#x3002;</li>
<li><code>breakOnSigint</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x82E5;&#x503C;&#x4E3A; <code>true</code>&#xFF0C;&#x5F53;&#x6536;&#x5230; <code>SIGINT</code> (Ctrl+C)&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x3002;
&#x6B64;&#x5916;&#xFF0C;&#x901A;&#x8FC7; <code>process.on(&apos;SIGINT&apos;)</code> &#x65B9;&#x6CD5;&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x6D88;&#x606F;&#x54CD;&#x5E94;&#x673A;&#x5236;&#x5728;&#x4EE3;&#x7801;&#x88AB;&#x6267;&#x884C;&#x65F6;&#x4F1A;&#x88AB;&#x5C4F;&#x853D;&#xFF0C;&#x4F46;&#x4EE3;&#x7801;&#x88AB;&#x7EC8;&#x6B62;&#x540E;&#x4F1A;&#x88AB;&#x6062;&#x590D;&#x3002;&#x5982;&#x679C;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a> &#x4F1A;&#x88AB;&#x629B;&#x51FA;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
</ul>
</li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="nofollow" class="type">&lt;any&gt;</a> &#x811A;&#x672C;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;&#x3002;</li>
</ul>
<p>&#x5728;&#x6307;&#x5B9A;&#x7684; <code>global</code> &#x5BF9;&#x8C61;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x6267;&#x884C; <code>vm.Script</code> &#x5BF9;&#x8C61;&#x91CC;&#x88AB;&#x7F16;&#x8BD1;&#x7684;&#x4EE3;&#x7801;&#x5E76;&#x8FD4;&#x56DE;&#x5176;&#x7ED3;&#x679C;&#x3002;&#x88AB;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x867D;&#x7136;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x4F46;&#x662F;&#x80FD;&#x83B7;&#x53D6; <code>global</code> &#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x7684;&#x4F8B;&#x5B50;&#x4F1A;&#x7F16;&#x8BD1;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x8BE5;&#x4EE3;&#x7801;&#x4F1A;&#x9012;&#x589E;&#x4E00;&#x4E2A; <code>global</code> &#x53D8;&#x91CF;&#x3002;&#x540C;&#x65F6;&#x8BE5;&#x4EE3;&#x7801;&#x88AB;&#x7F16;&#x8BD1;&#x540E;&#x4F1A;&#x88AB;&#x591A;&#x6B21;&#x6267;&#x884C;&#x3002;</p>
<pre><code class="language-js">const vm = require(&apos;vm&apos;);

global.globalVar = 0;

const script = new vm.Script(&apos;globalVar += 1&apos;, { filename: &apos;myfile.vm&apos; });

for (let i = 0; i &lt; 1000; ++i) {
  script.runInThisContext();
}

console.log(globalVar);

// 1000
</code></pre>
<h2>vm.SourceTextModule &#x7C7B;<span><a class="mark" href="vm.html#vm_class_vm_sourcetextmodule" id="vm_class_vm_sourcetextmodule">#</a></span></h2><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v9.6.0</span>
</div>
<p></p><div class="api_stability api_stability_1"><a target="_blank" rel="nofollow" href="documentation.html#documentation_stability_index">&#x7A33;&#x5B9A;&#x6027;: 1</a> - &#x8BD5;&#x9A8C;</div><p></p>
<p><em>This feature is only available with the <code>--experimental-vm-modules</code> command
flag enabled.</em></p>
<p>The <code>vm.SourceTextModule</code> class provides a low-level interface for using
ECMAScript modules in VM contexts. It is the counterpart of the <code>vm.Script</code>
class that closely mirrors <a href="http://nodejs.cn/s/gCBZGk" rel="nofollow">Source Text Module Record</a>s as defined in the
ECMAScript specification.</p>
<p>Unlike <code>vm.Script</code> however, every <code>vm.SourceTextModule</code> object is bound to a
context from its creation. Operations on <code>vm.SourceTextModule</code> objects are
intrinsically asynchronous, in contrast with the synchronous nature of
<code>vm.Script</code> objects. With the help of async functions, however, manipulating
<code>vm.SourceTextModule</code> objects is fairly straightforward.</p>
<p>Using a <code>vm.SourceTextModule</code> object requires three distinct steps:
creation/parsing, linking, and evaluation. These three steps are illustrated in
the following example.</p>
<p>This implementation lies at a lower level than the <a href="http://nodejs.cn/s/v4p4aU" rel="nofollow">ECMAScript Module
loader</a>. There is also currently no way to interact with the Loader, though
support is planned.</p>
<pre><code class="language-js">const vm = require(&apos;vm&apos;);

const contextifiedSandbox = vm.createContext({ secret: 42 });

(async () =&gt; {
  // Step 1
  //
  // Create a Module by constructing a new `vm.SourceTextModule` object. This
  // parses the provided source text, throwing a `SyntaxError` if anything goes
  // wrong. By default, a Module is created in the top context. But here, we
  // specify `contextifiedSandbox` as the context this Module belongs to.
  //
  // Here, we attempt to obtain the default export from the module &quot;foo&quot;, and
  // put it into local binding &quot;secret&quot;.

  const bar = new vm.SourceTextModule(`
    import s from &apos;foo&apos;;
    s;
  `, { context: contextifiedSandbox });

  // Step 2
  //
  // &quot;Link&quot; the imported dependencies of this Module to it.
  //
  // The provided linking callback (the &quot;linker&quot;) accepts two arguments: the
  // parent module (`bar` in this case) and the string that is the specifier of
  // the imported module. The callback is expected to return a Module that
  // corresponds to the provided specifier, with certain requirements documented
  // in `module.link()`.
  //
  // If linking has not started for the returned Module, the same linker
  // callback will be called on the returned Module.
  //
  // Even top-level Modules without dependencies must be explicitly linked. The
  // callback provided would never be called, however.
  //
  // The link() method returns a Promise that will be resolved when all the
  // Promises returned by the linker resolve.
  //
  // Note: This is a contrived example in that the linker function creates a new
  // &quot;foo&quot; module every time it is called. In a full-fledged module system, a
  // cache would probably be used to avoid duplicated modules.

  async function linker(specifier, referencingModule) {
    if (specifier === &apos;foo&apos;) {
      return new vm.SourceTextModule(`
        // The &quot;secret&quot; variable refers to the global variable we added to
        // &quot;contextifiedSandbox&quot; when creating the context.
        export default secret;
      `, { context: referencingModule.context });

      // Using `contextifiedSandbox` instead of `referencingModule.context`
      // here would work as well.
    }
    throw new Error(`Unable to resolve dependency: ${specifier}`);
  }
  await bar.link(linker);

  // Step 3
  //
  // Evaluate the Module. The evaluate() method returns a Promise with a single
  // property &quot;result&quot; that contains the result of the very last statement
  // executed in the Module. In the case of `bar`, it is `s;`, which refers to
  // the default export of the `foo` module, the `secret` we set in the
  // beginning to 42.

  const { result } = await bar.evaluate();

  console.log(result);
  // Prints 42.
})();
</code></pre>
<h3>new vm.SourceTextModule(code[, options])<span><a class="mark" href="vm.html#vm_constructor_new_vm_sourcetextmodule_code_options" id="vm_constructor_new_vm_sourcetextmodule_code_options">#</a></span></h3><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<ul>
<li><code>code</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> JavaScript Module code to parse</li>
<li>
<p><code>options</code></p>
<ul>
<li><code>identifier</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> String used in stack traces.
<strong>Default:</strong> <code>&apos;vm:module(i)&apos;</code> where <code>i</code> is a context-specific ascending
index.</li>
<li><code>context</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> The <a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">contextified</a> object as returned by the
<code>vm.createContext()</code> method, to compile and evaluate this <code>Module</code> in.</li>
<li><code>lineOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> Specifies the line number offset that is displayed
in stack traces produced by this <code>Module</code>. <strong>Default:</strong> <code>0</code>.</li>
<li><code>columnOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> Specifies the column number offset that is
displayed in stack traces produced by this <code>Module</code>. <strong>Default:</strong> <code>0</code>.</li>
<li>
<p><code>initializeImportMeta</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a> Called during evaluation of this <code>Module</code>
to initialize the <code>import.meta</code>.</p>
<ul>
<li><code>meta</code> <a href="http://nodejs.cn/s/pmknLX" target="_blank" rel="nofollow" class="type">&lt;import.meta&gt;</a></li>
<li><code>module</code> <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a></li>
</ul>
</li>
<li>
<p><code>importModuleDynamically</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a> Called during evaluation of this module
when <code>import()</code> is called. If this option is not specified, calls to
<code>import()</code> will reject with <a href="http://nodejs.cn/s/fqox4U" rel="nofollow"><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code></a>.</p>
<ul>
<li><code>specifier</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> specifier passed to <code>import()</code></li>
<li><code>module</code> <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a></li>
<li>Returns: <a href="http://nodejs.cn/s/uwQPrn" target="_blank" rel="nofollow" class="type">&lt;Module Namespace Object&gt;</a> | <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a> Returning a
<code>vm.SourceTextModule</code> is recommended in order to take advantage of error
tracking, and to avoid issues with namespaces that contain <code>then</code>
function exports.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Creates a new ES <code>Module</code> object.</p>
<p>Properties assigned to the <code>import.meta</code> object that are objects may
allow the <code>Module</code> to access information outside the specified <code>context</code>, if the
object is created in the top level context. Use <code>vm.runInContext()</code> to create
objects in a specific context.</p>
<pre><code class="language-js">const vm = require(&apos;vm&apos;);

const contextifiedSandbox = vm.createContext({ secret: 42 });

(async () =&gt; {
  const module = new vm.SourceTextModule(
    &apos;Object.getPrototypeOf(import.meta.prop).secret = secret;&apos;,
    {
      initializeImportMeta(meta) {
        // Note: this object is created in the top context. As such,
        // Object.getPrototypeOf(import.meta.prop) points to the
        // Object.prototype in the top context rather than that in
        // the sandbox.
        meta.prop = {};
      }
    });
  // Since module has no dependencies, the linker function will never be called.
  await module.link(() =&gt; {});
  await module.evaluate();

  // Now, Object.prototype.secret will be equal to 42.
  //
  // To fix this problem, replace
  //     meta.prop = {};
  // above with
  //     meta.prop = vm.runInContext(&apos;{}&apos;, contextifiedSandbox);
})();
</code></pre>
<h3>module.dependencySpecifiers<span><a class="mark" href="vm.html#vm_module_dependencyspecifiers" id="vm_module_dependencyspecifiers">#</a></span></h3><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<ul>
<li><a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string[]&gt;</a></li>
</ul>
<p>The specifiers of all dependencies of this module. The returned array is frozen
to disallow any changes to it.</p>
<p>Corresponds to the <code>[[RequestedModules]]</code> field of
<a href="http://nodejs.cn/s/gCBZGk" rel="nofollow">Source Text Module Record</a>s in the ECMAScript specification.</p>
<h3>module.error<span><a class="mark" href="vm.html#vm_module_error" id="vm_module_error">#</a></span></h3><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<ul>
<li><a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="nofollow" class="type">&lt;any&gt;</a></li>
</ul>
<p>If the <code>module.status</code> is <code>&apos;errored&apos;</code>, this property contains the exception
thrown by the module during evaluation. If the status is anything else,
accessing this property will result in a thrown exception.</p>
<p>The value <code>undefined</code> cannot be used for cases where there is not a thrown
exception due to possible ambiguity with <code>throw undefined;</code>.</p>
<p>Corresponds to the <code>[[EvaluationError]]</code> field of <a href="http://nodejs.cn/s/gCBZGk" rel="nofollow">Source Text Module Record</a>s
in the ECMAScript specification.</p>
<h3>module.evaluate([options])<span><a class="mark" href="vm.html#vm_module_evaluate_options" id="vm_module_evaluate_options">#</a></span></h3><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<ul>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>timeout</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> Specifies the number of milliseconds to evaluate
before terminating execution. If execution is interrupted, an <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>
will be thrown. This value must be a strictly positive integer.</li>
<li><code>breakOnSigint</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> If <code>true</code>, the execution will be terminated when
<code>SIGINT</code> (Ctrl+C) is received. Existing handlers for the event that have
been attached via <code>process.on(&apos;SIGINT&apos;)</code> will be disabled during script
execution, but will continue to work after that. If execution is
interrupted, an <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a> will be thrown. <strong>Default:</strong> <code>false</code>.</li>
</ul>
</li>
<li>Returns: <a href="http://nodejs.cn/s/ri1kj8" target="_blank" rel="nofollow" class="type">&lt;Promise&gt;</a></li>
</ul>
<p>Evaluate the module.</p>
<p>This must be called after the module has been linked; otherwise it will
throw an error. It could be called also when the module has already been
evaluated, in which case it will do one of the following two things:</p>
<ul>
<li>return <code>undefined</code> if the initial evaluation ended in success (<code>module.status</code>
is <code>&apos;evaluated&apos;</code>)</li>
<li>rethrow the same exception the initial evaluation threw if the initial
evaluation ended in an error (<code>module.status</code> is <code>&apos;errored&apos;</code>)</li>
</ul>
<p>This method cannot be called while the module is being evaluated
(<code>module.status</code> is <code>&apos;evaluating&apos;</code>) to prevent infinite recursion.</p>
<p>Corresponds to the <a href="http://nodejs.cn/s/J4YRhE" rel="nofollow">Evaluate() concrete method</a> field of <a href="http://nodejs.cn/s/gCBZGk" rel="nofollow">Source Text Module
Record</a>s in the ECMAScript specification.</p>
<h3>module.link(linker)<span><a class="mark" href="vm.html#vm_module_link_linker" id="vm_module_link_linker">#</a></span></h3><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<ul>
<li>
<p><code>linker</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a></p>
<ul>
<li>
<p><code>specifier</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> The specifier of the requested module:</p>
<!-- eslint-skip -->
<pre><code class="language-js">import foo from &apos;foo&apos;;
//              ^^^^^ the module specifier
</code></pre>
</li>
<li>
<p><code>referencingModule</code> <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a> The <code>Module</code> object <code>link()</code> is
called on.</p>
</li>
<li>
<p>Returns: <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a> | <a href="http://nodejs.cn/s/ri1kj8" target="_blank" rel="nofollow" class="type">&lt;Promise&gt;</a></p>
</li>
</ul>
</li>
<li>
<p>Returns: <a href="http://nodejs.cn/s/ri1kj8" target="_blank" rel="nofollow" class="type">&lt;Promise&gt;</a></p>
</li>
</ul>
<p>Link module dependencies. This method must be called before evaluation, and
can only be called once per module.</p>
<p>The function is expected to return a <code>Module</code> object or a <code>Promise</code> that
eventually resolves to a <code>Module</code> object. The returned <code>Module</code> must satisfy the
following two invariants:</p>
<ul>
<li>It must belong to the same context as the parent <code>Module</code>.</li>
<li>Its <code>status</code> must not be <code>&apos;errored&apos;</code>.</li>
</ul>
<p>If the returned <code>Module</code>&apos;s <code>status</code> is <code>&apos;unlinked&apos;</code>, this method will be
recursively called on the returned <code>Module</code> with the same provided <code>linker</code>
function.</p>
<p><code>link()</code> returns a <code>Promise</code> that will either get resolved when all linking
instances resolve to a valid <code>Module</code>, or rejected if the linker function either
throws an exception or returns an invalid <code>Module</code>.</p>
<p>The linker function roughly corresponds to the implementation-defined
<a href="http://nodejs.cn/s/DjcMRi" rel="nofollow">HostResolveImportedModule</a> abstract operation in the ECMAScript
specification, with a few key differences:</p>
<ul>
<li>The linker function is allowed to be asynchronous while
<a href="http://nodejs.cn/s/DjcMRi" rel="nofollow">HostResolveImportedModule</a> is synchronous.</li>
</ul>
<p>The actual <a href="http://nodejs.cn/s/DjcMRi" rel="nofollow">HostResolveImportedModule</a> implementation used during module
linking is one that returns the modules linked during linking. Since at
that point all modules would have been fully linked already, the
<a href="http://nodejs.cn/s/DjcMRi" rel="nofollow">HostResolveImportedModule</a> implementation is fully synchronous per
specification.</p>
<p>Corresponds to the <a href="http://nodejs.cn/s/NSenof" rel="nofollow">Link() concrete method</a> field of <a href="http://nodejs.cn/s/gCBZGk" rel="nofollow">Source Text Module
Record</a>s in the ECMAScript specification.</p>
<h3>module.namespace<span><a class="mark" href="vm.html#vm_module_namespace" id="vm_module_namespace">#</a></span></h3><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<ul>
<li><a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></li>
</ul>
<p>The namespace object of the module. This is only available after linking
(<code>module.link()</code>) has completed.</p>
<p>Corresponds to the <a href="http://nodejs.cn/s/8AR3t2" rel="nofollow">GetModuleNamespace</a> abstract operation in the ECMAScript
specification.</p>
<h3>module.status<span><a class="mark" href="vm.html#vm_module_status" id="vm_module_status">#</a></span></h3><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<ul>
<li><a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a></li>
</ul>
<p>The current status of the module. Will be one of:</p>
<ul>
<li>
<p><code>&apos;unlinked&apos;</code>: <code>module.link()</code> has not yet been called.</p>
</li>
<li>
<p><code>&apos;linking&apos;</code>: <code>module.link()</code> has been called, but not all Promises returned
by the linker function have been resolved yet.</p>
</li>
<li>
<p><code>&apos;linked&apos;</code>: The module has been linked successfully, and all of its
dependencies are linked, but <code>module.evaluate()</code> has not yet been called.</p>
</li>
<li>
<p><code>&apos;evaluating&apos;</code>: The module is being evaluated through a <code>module.evaluate()</code> on
itself or a parent module.</p>
</li>
<li>
<p><code>&apos;evaluated&apos;</code>: The module has been successfully evaluated.</p>
</li>
<li>
<p><code>&apos;errored&apos;</code>: The module has been evaluated, but an exception was thrown.</p>
</li>
</ul>
<p>Other than <code>&apos;errored&apos;</code>, this status string corresponds to the specification&apos;s
<a href="http://nodejs.cn/s/gCBZGk" rel="nofollow">Source Text Module Record</a>&apos;s <code>[[Status]]</code> field. <code>&apos;errored&apos;</code> corresponds to
<code>&apos;evaluated&apos;</code> in the specification, but with <code>[[EvaluationError]]</code> set to a
value that is not <code>undefined</code>.</p>
<h3>module.identifier<span><a class="mark" href="vm.html#vm_module_identifier" id="vm_module_identifier">#</a></span></h3><p class="tip_wrap"><span class="tip_no_trans">&#x6682;&#x65E0;&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</span></p>
<ul>
<li><a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a></li>
</ul>
<p>The identifier of the current module, as set in the constructor.</p>
<h2>vm.compileFunction(code[, params[, options]])<span><a class="mark" href="vm.html#vm_vm_compilefunction_code_params_options" id="vm_vm_compilefunction_code_params_options">#</a></span></h2><p class="tip_wrap"><a href="vm/vm_compilefunction_code_params_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/vm_compilefunction_code_params_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v10.10.0</span>
</div>
<ul>
<li><code>code</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x9700;&#x8981;&#x7F16;&#x8BD1;&#x7684;&#x51FD;&#x6570;&#x4F53;&#x3002;</li>
<li><code>params</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string[]&gt;</a> &#x5305;&#x542B;&#x6240;&#x6709;&#x51FD;&#x6570;&#x53C2;&#x6570;&#x7684;&#x5B57;&#x7B26;&#x4E32;&#x6570;&#x7EC4;&#x3002;</li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>filename</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5B9A;&#x4E49;&#x6B64;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x4E2D;&#x4F7F;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002; <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;&apos;</code>&#x3002;</li>
<li><code>lineOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x6B64;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x4E2D;&#x663E;&#x793A;&#x7684;&#x884C;&#x53F7;&#x504F;&#x79FB;&#x91CF;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>columnOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x6B64;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4E2D;&#x663E;&#x793A;&#x7684;&#x5217;&#x504F;&#x79FB;&#x91CF;&#x3002; <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>cachedData</code> <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="nofollow" class="type">&lt;Buffer&gt;</a> | <a href="http://nodejs.cn/s/oh3CkV" target="_blank" rel="nofollow" class="type">&lt;TypedArray&gt;</a> | <a href="http://nodejs.cn/s/yCdVkD" target="_blank" rel="nofollow" class="type">&lt;DataView&gt;</a> &#x4E3A;&#x6E90;&#x7801;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A; <code>Buffer</code>&#x3001; <code>TypedArray</code> &#x6216; <code>DataView</code> &#x683C;&#x5F0F;&#x7684; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x3002;</li>
<li><code>produceCachedData</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5B9A;&#x4E49;&#x662F;&#x5426;&#x9700;&#x8981;&#x751F;&#x6210;&#x65B0;&#x7684;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li><code>parsingContext</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> &#x7F16;&#x8BD1;&#x51FD;&#x6570;&#x7684;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x7684;&#x6C99;&#x7BB1;&#x3002;</li>
<li><code>contextExtensions</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object[]&gt;</a>  &#x5305;&#x542B;&#x8981;&#x5728;&#x7F16;&#x8BD1;&#x65F6;&#x5E94;&#x7528;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x6269;&#x5C55;&#xFF08;&#x5305;&#x88C5;&#x5F53;&#x524D;&#x8303;&#x56F4;&#x7684;&#x5BF9;&#x8C61;&#xFF09;&#x7684;&#x96C6;&#x5408;&#x7684;&#x6570;&#x7EC4;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>[]</code>&#x3002;</li>
</ul>
</li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a></li>
</ul>
<p>&#x5C06;&#x7ED9;&#x5B9A;&#x7684;&#x4EE3;&#x7801;&#x7F16;&#x8BD1;&#x5230;&#x63D0;&#x4F9B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;/&#x6C99;&#x7BB1;&#x4E2D;&#xFF08;&#x5982;&#x679C;&#x6CA1;&#x6709;&#x63D0;&#x4F9B;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5219;&#x4F7F;&#x7528;&#x5F53;&#x524D;&#x4E0A;&#x4E0B;&#x6587;&#xFF09;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x5305;&#x88C5;&#x4E86;&#x7ED9;&#x5B9A; <code>params</code> &#x7684;&#x51FD;&#x6570;&#x3002;</p>
<h2>vm.createContext([sandbox[, options]])<span><a class="mark" href="vm.html#vm_vm_createcontext_sandbox_options" id="vm_vm_createcontext_sandbox_options">#</a></span></h2><p class="tip_wrap"><a href="vm/vm_createcontext_sandbox_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/vm_createcontext_sandbox_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v10.0.0</td>
<td><p>The <code>sandbox</code> object can no longer be a function.</p></td></tr>
<tr><td>v10.0.0</td>
<td><p>The <code>codeGeneration</code> option is supported now.</p></td></tr>
<tr><td>v0.3.1</td>
<td><p><span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span></p></td></tr>
</tbody></table>
</details>
</div>
<ul>
<li><code>sandbox</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>name</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x65B0;&#x521B;&#x5EFA;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4EBA;&#x7C7B;&#x53EF;&#x8BFB;&#x540D;&#x79F0;&#x3002; <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;VM Context i&apos;</code>&#xFF0C;&#x5176;&#x4E2D; <code>i</code> &#x662F;&#x521B;&#x5EFA;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x5347;&#x5E8F;&#x6570;&#x5B57;&#x7D22;&#x5F15;&#x3002;</li>
<li><code>origin</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5BF9;&#x5E94;&#x4E8E;&#x65B0;&#x521B;&#x5EFA;&#x7528;&#x4E8E;&#x663E;&#x793A;&#x76EE;&#x7684;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;<a href="http://nodejs.cn/s/SYyZxA" rel="nofollow">&#x539F;&#x70B9;</a>&#x3002;
&#x539F;&#x70B9;&#x5E94;&#x683C;&#x5F0F;&#x5316;&#x4E3A;&#x7C7B;&#x4F3C;&#x4E00;&#x4E2A; URL&#xFF0C;&#x4F46;&#x53EA;&#x5305;&#x542B;&#x534F;&#x8BAE;&#xFF0C;&#x4E3B;&#x673A;&#x548C;&#x7AEF;&#x53E3;&#xFF08;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF09;&#xFF0C;&#x4F8B;&#x5982; <a href="http://nodejs.cn/s/vzpPx2" rel="nofollow"><code>URL</code></a> &#x5BF9;&#x8C61;&#x7684; <a href="http://nodejs.cn/s/rpuY73" rel="nofollow"><code>url.origin</code></a> &#x5C5E;&#x6027;&#x7684;&#x503C;&#x3002; &#x6700;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6B64;&#x5B57;&#x7B26;&#x4E32;&#x5E94;&#x7701;&#x7565;&#x5C3E;&#x90E8;&#x659C;&#x6760;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x8868;&#x793A;&#x8DEF;&#x5F84;&#x3002; <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;&apos;</code>&#x3002;</li>
<li>
<p><code>codeGeneration</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>strings</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A; <code>false</code>&#xFF0C;&#x5219;&#x5BF9; <code>eval</code> &#x6216;&#x51FD;&#x6570;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;<code>Function</code>&#x3001; <code>GeneratorFunction</code> &#x7B49;&#xFF09;&#x7684;&#x4EFB;&#x4F55;&#x8C03;&#x7528;&#x90FD;&#x5C06;&#x629B;&#x51FA; <code>EvalError</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>wasm</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A; <code>false</code>&#xFF0C;&#x5219;&#x4EFB;&#x4F55;&#x7F16;&#x8BD1; WebAssembly &#x6A21;&#x5757;&#x7684;&#x5C1D;&#x8BD5;&#x90FD;&#x5C06;&#x629B;&#x51FA; <code>WebAssembly.CompileError</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
</ul>
</li>
</ul>
</li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> &#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;&#x7684;&#x6C99;&#x76D2;&#x3002;</li>
</ul>
<p>&#x7ED9;&#x5B9A;&#x4E00;&#x4E2A; <code>sandbox</code> &#x5BF9;&#x8C61;&#xFF0C; <code>vm.createContext()</code> &#x4F1A;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x8BBE;&#x7F6E;&#x6B64;&#x6C99;&#x76D2;</a>&#xFF0C;&#x4ECE;&#x800C;&#x8BA9;&#x5B83;&#x5177;&#x5907;&#x5728; <a href="http://nodejs.cn/s/bGFfjZ" rel="nofollow"><code>vm.runInContext()</code></a> &#x6216;&#x8005; <a href="http://nodejs.cn/s/wnkk4u" rel="nofollow"><code>script.runInContext()</code></a> &#x4E2D;&#x88AB;&#x4F7F;&#x7528;&#x7684;&#x80FD;&#x529B;&#x3002;
&#x5BF9;&#x4E8E;&#x6B64;&#x4E8C;&#x65B9;&#x6CD5;&#x4E2D;&#x6240;&#x8C03;&#x7528;&#x7684;&#x811A;&#x672C;&#xFF0C;&#x4ED6;&#x4EEC;&#x7684;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#x4E0D;&#x4EC5;&#x62E5;&#x6709;&#x6211;&#x4EEC;&#x63D0;&#x4F9B;&#x7684; <code>sandbox</code> &#x5BF9;&#x8C61;&#x7684;&#x6240;&#x6709;&#x5C5E;&#x6027;&#xFF0C;&#x540C;&#x65F6;&#x8FD8;&#x6709;&#x4EFB;&#x4F55;<a href="http://nodejs.cn/s/hKgpea" rel="nofollow">&#x5168;&#x5C40;&#x5BF9;&#x8C61;</a>&#x6240;&#x62E5;&#x6709;&#x7684;&#x5C5E;&#x6027;&#x3002;
&#x5BF9;&#x4E8E;&#x8FD9;&#x4E9B;&#x811A;&#x672C;&#x4E4B;&#x5916;&#x7684;&#x6240;&#x6709;&#x4EE3;&#x7801;&#xFF0C;&#x4ED6;&#x4EEC;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x5C06;&#x4FDD;&#x6301;&#x4E0D;&#x53D8;&#x3002;</p>
<pre><code class="language-js">const util = require(&apos;util&apos;);
const vm = require(&apos;vm&apos;);

global.globalVar = 3;

const sandbox = { globalVar: 1 };
vm.createContext(sandbox);

vm.runInContext(&apos;globalVar *= 2;&apos;, sandbox);

console.log(util.inspect(sandbox)); // { globalVar: 2 }

console.log(util.inspect(globalVar)); // 3
</code></pre>
<p>&#x5982;&#x679C;&#x672A;&#x63D0;&#x4F9B; <code>sandbox</code>&#xFF08;&#x6216;&#x8005;&#x4F20;&#x5165;<code>undefined</code>&#xFF09;&#xFF0C;&#x90A3;&#x4E48;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5168;&#x65B0;&#x7684;&#x7A7A;&#x7684;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x540E;&#x7684; <code>sandbox</code> &#x5BF9;&#x8C61;&#x3002;</p>
<p><code>vm.createContext()</code> &#x4E3B;&#x8981;&#x662F;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x80FD;&#x8FD0;&#x884C;&#x591A;&#x4E2A;&#x811A;&#x672C;&#x7684;&#x6C99;&#x76D2;&#x3002;
&#x6BD4;&#x5982;&#x8BF4;&#xFF0C;&#x5728;&#x6A21;&#x62DF;&#x4E00;&#x4E2A;&#x7F51;&#x9875;&#x6D4F;&#x89C8;&#x5668;&#x65F6;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x88AB;&#x7528;&#x4E8E;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x6C99;&#x76D2;&#x6765;&#x4EE3;&#x8868;&#x4E00;&#x4E2A;&#x7A97;&#x53E3;&#x7684;&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#xFF0C;&#x7136;&#x540E;&#x6240;&#x6709;&#x7684; <code>&lt;script&gt;</code> &#x6807;&#x7B7E;&#x90FD;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x4E2A;&#x6C99;&#x76D2;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x8FD0;&#x884C;&#x3002;</p>
<p>&#x901A;&#x8FC7; Inspector API &#x53EF;&#x4EE5;&#x770B;&#x5230;&#x63D0;&#x4F9B;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684; <code>name</code> &#x548C; <code>origin</code>&#x3002;</p>
<h2>vm.isContext(sandbox)<span><a class="mark" href="vm.html#vm_vm_iscontext_sandbox" id="vm_vm_iscontext_sandbox">#</a></span></h2><p class="tip_wrap"><a href="vm/vm_iscontext_sandbox.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/vm_iscontext_sandbox.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<span>&#x65B0;&#x589E;&#x4E8E;: v0.11.7</span>
</div>
<ul>
<li><code>sandbox</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a></li>
</ul>
<p>&#x5F53;&#x7ED9;&#x5B9A;&#x7684; <code>sandbox</code> &#x5BF9;&#x8C61;&#x5DF2;&#x7ECF;&#x88AB; <a href="http://nodejs.cn/s/6WiPpe" rel="nofollow"><code>vm.createContext()</code></a> <a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#xFF0C;&#x5219;&#x8FD4;&#x56DE; <code>true</code>&#x3002;</p>
<h2>vm.runInContext(code, contextifiedSandbox[, options])<span><a class="mark" href="vm.html#vm_vm_runincontext_code_contextifiedsandbox_options" id="vm_vm_runincontext_code_contextifiedsandbox_options">#</a></span></h2><p class="tip_wrap"><a href="vm/vm_runincontext_code_contextifiedsandbox_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/vm_runincontext_code_contextifiedsandbox_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v6.3.0</td>
<td><p>The <code>breakOnSigint</code> option is supported now.</p></td></tr>
<tr><td>v0.3.1</td>
<td><p><span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span></p></td></tr>
</tbody></table>
</details>
</div>
<ul>
<li><code>code</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5C06;&#x88AB;&#x7F16;&#x8BD1;&#x548C;&#x8FD0;&#x884C;&#x7684; JavaScript &#x4EE3;&#x7801;&#x3002;</li>
<li><code>contextifiedSandbox</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> &#x4E00;&#x4E2A;&#x88AB;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x8FC7;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4F1A;&#x5728; <code>code</code> &#x88AB;&#x7F16;&#x8BD1;&#x548C;&#x6267;&#x884C;&#x4E4B;&#x540E;&#x5145;&#x5F53; <code>global</code> &#x5BF9;&#x8C61;&#x3002;</li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> | <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a></p>
<ul>
<li><code>filename</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5B9A;&#x4E49;&#x4F9B;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;evalmachine.&lt;anonymous&gt;&apos;</code>&#x3002;</li>
<li><code>lineOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x663E;&#x793A;&#x7684;&#x884C;&#x53F7;&#x504F;&#x79FB;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>columnOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x663E;&#x793A;&#x7684;&#x5217;&#x53F7;&#x504F;&#x79FB;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>displayErrors</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5047;&#x5982;&#x5728;&#x89E3;&#x6790;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x751F;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#xFF0C;&#x5F15;&#x8D77;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x5C06;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>timeout</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> &#x5B9A;&#x4E49;&#x5728;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x6B64; <code>code</code> &#x88AB;&#x5141;&#x8BB8;&#x6267;&#x884C;&#x7684;&#x6700;&#x5927;&#x6BEB;&#x79D2;&#x6570;&#x3002;&#x5047;&#x5982;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#x3002;&#x8BE5;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E25;&#x683C;&#x6B63;&#x6574;&#x6570;&#x3002;</li>
<li><code>breakOnSigint</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x82E5;&#x503C;&#x4E3A; <code>true</code>&#xFF0C;&#x5F53;&#x6536;&#x5230; <code>SIGINT</code> (Ctrl+C)&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x3002;
&#x6B64;&#x5916;&#xFF0C;&#x901A;&#x8FC7; <code>process.on(&apos;SIGINT&apos;)</code> &#x65B9;&#x6CD5;&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x6D88;&#x606F;&#x54CD;&#x5E94;&#x673A;&#x5236;&#x5728;&#x4EE3;&#x7801;&#x88AB;&#x6267;&#x884C;&#x65F6;&#x4F1A;&#x88AB;&#x5C4F;&#x853D;&#xFF0C;&#x4F46;&#x4EE3;&#x7801;&#x88AB;&#x7EC8;&#x6B62;&#x540E;&#x4F1A;&#x88AB;&#x6062;&#x590D;&#x3002;&#x5982;&#x679C;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a> &#x4F1A;&#x88AB;&#x629B;&#x51FA;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li><code>cachedData</code> <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="nofollow" class="type">&lt;Buffer&gt;</a> | <a href="http://nodejs.cn/s/oh3CkV" target="_blank" rel="nofollow" class="type">&lt;TypedArray&gt;</a> | <a href="http://nodejs.cn/s/yCdVkD" target="_blank" rel="nofollow" class="type">&lt;DataView&gt;</a> &#x4E3A;&#x6E90;&#x7801;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x5B58;&#x6709; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684; <code>Buffer</code>&#x3001; <code>TypedArray</code> &#x6216; <code>TypedArray</code>&#x3002;
&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x4E86;&#xFF0C;&#x5219; <code>cachedDataRejected</code> &#x7684;&#x503C;&#x5C06;&#x4F1A;&#x88AB;&#x8BBE;&#x4E3A;&#x8981;&#x4E48;&#x4E3A; <code>true</code> &#x8981;&#x4E48;&#x4E3A; <code>false</code>&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E; v8 &#x5F15;&#x64CE;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x63A5;&#x53D7;&#x72B6;&#x51B5;&#x3002;</li>
<li><code>produceCachedData</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x4E14; <code>cachedData</code> &#x4E0D;&#x5B58;&#x5728;&#x7684;&#x65F6;&#x5019;&#xFF0C;V8 &#x5C06;&#x4F1A;&#x8BD5;&#x56FE;&#x4E3A; <code>code</code> &#x751F;&#x6210;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x3002;
&#x4E00;&#x65E6;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x4E00;&#x4E2A;&#x6709; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684; <code>Buffer</code> &#x5C06;&#x4F1A;&#x88AB;&#x751F;&#x6210;&#x548C;&#x50A8;&#x5B58;&#x5728;&#x8FD4;&#x56DE;&#x7684; <code>vm.Script</code> &#x5B9E;&#x4F8B;&#x7684; <code>cachedData</code> &#x5C5E;&#x6027;&#x91CC;&#x3002;
<code>cachedDataProduced</code> &#x7684;&#x503C;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; <code>true</code> &#x6216;&#x8005; <code>false</code>&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x662F;&#x5426;&#x88AB;&#x6210;&#x529F;&#x751F;&#x6210;&#x3002;
&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>script.createCachedData()</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li>
<p><code>importModuleDynamically</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a> &#x5728;&#x8C03;&#x7528; <code>import()</code> &#x65F6;&#x8BC4;&#x4F30;&#x6B64;&#x6A21;&#x5757;&#x671F;&#x95F4;&#x8C03;&#x7528;&#x3002;
&#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x5219;&#x5BF9; <code>import()</code> &#x7684;&#x8C03;&#x7528;&#x5C06;&#x62D2;&#x7EDD; <a href="http://nodejs.cn/s/fqox4U" rel="nofollow"><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code></a>&#x3002;
&#x6B64;&#x9009;&#x9879;&#x662F; <code>--experimental-modules</code> &#x6807;&#x5FD7;&#x7684;&#x5B9E;&#x9A8C; API &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4E0D;&#x5E94;&#x88AB;&#x89C6;&#x4E3A;&#x7A33;&#x5B9A;&#x3002;</p>
<ul>
<li><code>specifier</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x4F20;&#x7ED9; <code>import()</code> &#x7684;&#x8BF4;&#x660E;&#x7B26;&#x3002;</li>
<li><code>module</code> <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a></li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/uwQPrn" target="_blank" rel="nofollow" class="type">&lt;Module Namespace Object&gt;</a> | <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a> &#x8FD4;&#x56DE; <code>vm.SourceTextModule</code> &#x4EE5;&#x5229;&#x7528;&#x9519;&#x8BEF;&#x8DDF;&#x8E2A;&#xFF0C;&#x5E76;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x5305;&#x542B; <code>then</code> &#x51FD;&#x6570;&#x5BFC;&#x51FA;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x95EE;&#x9898;&#x3002;</li>
</ul>
</li>
</ul>
</li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="nofollow" class="type">&lt;any&gt;</a> &#x811A;&#x672C;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;&#x3002;</li>
</ul>
<p><code>vm.runInContext()</code> &#x65B9;&#x6CD5;&#x4F1A;&#x7F16;&#x8BD1; <code>code</code>&#xFF0C;&#x7136;&#x540E;&#x5728;&#x6307;&#x5B9A;&#x7684; <code>contextifiedSandbox</code> &#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x91CC;&#x6267;&#x884C;&#x5B83;&#x5E76;&#x8FD4;&#x56DE;&#x5176;&#x7ED3;&#x679C;&#x3002;
&#x88AB;&#x6267;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x4F5C;&#x7528;&#x57DF;&#x3002;
<code>contextifiedSandbox</code> &#x5FC5;&#x987B;&#x662F;&#x4E8B;&#x5148;&#x88AB; <a href="http://nodejs.cn/s/6WiPpe" rel="nofollow"><code>vm.createContext()</code></a> &#x65B9;&#x6CD5;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x8FC7;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x5982;&#x679C; <code>options</code> &#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5219;&#x5B83;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x540D;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x4F8B;&#x5B50;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5355;&#x72EC;&#x7684;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x8FC7;&#x7684;&#x5BF9;&#x8C61;&#x6765;&#x7F16;&#x8BD1;&#x5E76;&#x8FD0;&#x884C;&#x51E0;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x811A;&#x672C;&#xFF1A;</p>
<pre><code class="language-js">const util = require(&apos;util&apos;);
const vm = require(&apos;vm&apos;);

const sandbox = { globalVar: 1 };
vm.createContext(sandbox);

for (let i = 0; i &lt; 10; ++i) {
  vm.runInContext(&apos;globalVar *= 2;&apos;, sandbox);
}
console.log(util.inspect(sandbox));

// { globalVar: 1024 }
</code></pre>
<h2>vm.runInNewContext(code[, sandbox[, options]])<span><a class="mark" href="vm.html#vm_vm_runinnewcontext_code_sandbox_options" id="vm_vm_runinnewcontext_code_sandbox_options">#</a></span></h2><p class="tip_wrap"><a href="vm/vm_runinnewcontext_code_sandbox_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/vm_runinnewcontext_code_sandbox_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v10.0.0</td>
<td><p>The <code>contextCodeGeneration</code> option is supported now.</p></td></tr>
<tr><td>v6.3.0</td>
<td><p>The <code>breakOnSigint</code> option is supported now.</p></td></tr>
<tr><td>v0.3.1</td>
<td><p><span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span></p></td></tr>
</tbody></table>
</details>
</div>
<ul>
<li><code>code</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5C06;&#x88AB;&#x7F16;&#x8BD1;&#x548C;&#x8FD0;&#x884C;&#x7684; JavaScript &#x4EE3;&#x7801;&#x3002;</li>
<li><code>sandbox</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> &#x4E00;&#x4E2A;&#x5C06;&#x4F1A;&#x88AB;<a href="http://nodejs.cn/s/x6KGQQ" rel="nofollow">&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;</a>&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x5982;&#x679C;&#x662F; <code>undefined</code>, &#x5219;&#x4F1A;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x5BF9;&#x8C61;&#x3002;</li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> | <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a></p>
<ul>
<li><code>filename</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5B9A;&#x4E49;&#x4F9B;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;evalmachine.&lt;anonymous&gt;&apos;</code>&#x3002;</li>
<li><code>lineOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x663E;&#x793A;&#x7684;&#x884C;&#x53F7;&#x504F;&#x79FB;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>columnOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x663E;&#x793A;&#x7684;&#x5217;&#x53F7;&#x504F;&#x79FB;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>displayErrors</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5047;&#x5982;&#x5728;&#x89E3;&#x6790;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x751F;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#xFF0C;&#x5F15;&#x8D77;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x5C06;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>timeout</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> &#x5B9A;&#x4E49;&#x5728;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x6B64; <code>code</code> &#x88AB;&#x5141;&#x8BB8;&#x6267;&#x884C;&#x7684;&#x6700;&#x5927;&#x6BEB;&#x79D2;&#x6570;&#x3002;&#x5047;&#x5982;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#x3002;&#x8BE5;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E25;&#x683C;&#x6B63;&#x6574;&#x6570;&#x3002;</li>
<li><code>breakOnSigint</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x82E5;&#x503C;&#x4E3A; <code>true</code>&#xFF0C;&#x5F53;&#x6536;&#x5230; <code>SIGINT</code> (Ctrl+C)&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x3002;
&#x6B64;&#x5916;&#xFF0C;&#x901A;&#x8FC7; <code>process.on(&apos;SIGINT&apos;)</code> &#x65B9;&#x6CD5;&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x6D88;&#x606F;&#x54CD;&#x5E94;&#x673A;&#x5236;&#x5728;&#x4EE3;&#x7801;&#x88AB;&#x6267;&#x884C;&#x65F6;&#x4F1A;&#x88AB;&#x5C4F;&#x853D;&#xFF0C;&#x4F46;&#x4EE3;&#x7801;&#x88AB;&#x7EC8;&#x6B62;&#x540E;&#x4F1A;&#x88AB;&#x6062;&#x590D;&#x3002;&#x5982;&#x679C;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a> &#x4F1A;&#x88AB;&#x629B;&#x51FA;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li><code>contextName</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x65B0;&#x521B;&#x5EFA;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x4EBA;&#x7C7B;&#x53EF;&#x8BFB;&#x540D;&#x79F0;&#x3002; <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;VM Context i&apos;</code>&#xFF0C;&#x5176;&#x4E2D; <code>i</code> &#x662F;&#x521B;&#x5EFA;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x5347;&#x5E8F;&#x6570;&#x5B57;&#x7D22;&#x5F15;&#x3002;</li>
<li><code>contextOrigin</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5BF9;&#x5E94;&#x4E8E;&#x65B0;&#x521B;&#x5EFA;&#x7528;&#x4E8E;&#x663E;&#x793A;&#x76EE;&#x7684;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7684;<a href="http://nodejs.cn/s/SYyZxA" rel="nofollow">&#x539F;&#x70B9;</a>&#x3002;
&#x539F;&#x70B9;&#x5E94;&#x683C;&#x5F0F;&#x5316;&#x4E3A;&#x7C7B;&#x4F3C;&#x4E00;&#x4E2A; URL&#xFF0C;&#x4F46;&#x53EA;&#x5305;&#x542B;&#x534F;&#x8BAE;&#xFF0C;&#x4E3B;&#x673A;&#x548C;&#x7AEF;&#x53E3;&#xFF08;&#x5982;&#x679C;&#x9700;&#x8981;&#xFF09;&#xFF0C;&#x4F8B;&#x5982; <a href="http://nodejs.cn/s/vzpPx2" rel="nofollow"><code>URL</code></a> &#x5BF9;&#x8C61;&#x7684; <a href="http://nodejs.cn/s/rpuY73" rel="nofollow"><code>url.origin</code></a> &#x5C5E;&#x6027;&#x7684;&#x503C;&#x3002; &#x6700;&#x503C;&#x5F97;&#x6CE8;&#x610F;&#x7684;&#x662F;&#xFF0C;&#x6B64;&#x5B57;&#x7B26;&#x4E32;&#x5E94;&#x7701;&#x7565;&#x5C3E;&#x90E8;&#x659C;&#x6760;&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x8868;&#x793A;&#x8DEF;&#x5F84;&#x3002; <strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;&apos;</code>&#x3002;</li>
<li>
<p><code>contextCodeGeneration</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a></p>
<ul>
<li><code>strings</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A; <code>false</code>&#xFF0C;&#x5219;&#x5BF9; <code>eval</code> &#x6216;&#x51FD;&#x6570;&#x6784;&#x9020;&#x51FD;&#x6570;&#xFF08;<code>Function</code>&#x3001; <code>GeneratorFunction</code> &#x7B49;&#xFF09;&#x7684;&#x4EFB;&#x4F55;&#x8C03;&#x7528;&#x90FD;&#x5C06;&#x629B;&#x51FA; <code>EvalError</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>wasm</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5982;&#x679C;&#x8BBE;&#x7F6E;&#x4E3A; <code>false</code>&#xFF0C;&#x5219;&#x4EFB;&#x4F55;&#x7F16;&#x8BD1; WebAssembly &#x6A21;&#x5757;&#x7684;&#x5C1D;&#x8BD5;&#x90FD;&#x5C06;&#x629B;&#x51FA; <code>WebAssembly.CompileError</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
</ul>
</li>
<li><code>cachedData</code> <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="nofollow" class="type">&lt;Buffer&gt;</a> | <a href="http://nodejs.cn/s/oh3CkV" target="_blank" rel="nofollow" class="type">&lt;TypedArray&gt;</a> | <a href="http://nodejs.cn/s/yCdVkD" target="_blank" rel="nofollow" class="type">&lt;DataView&gt;</a> &#x4E3A;&#x6E90;&#x7801;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x5B58;&#x6709; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684; <code>Buffer</code>&#x3001; <code>TypedArray</code> &#x6216; <code>TypedArray</code>&#x3002;
&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x4E86;&#xFF0C;&#x5219; <code>cachedDataRejected</code> &#x7684;&#x503C;&#x5C06;&#x4F1A;&#x88AB;&#x8BBE;&#x4E3A;&#x8981;&#x4E48;&#x4E3A; <code>true</code> &#x8981;&#x4E48;&#x4E3A; <code>false</code>&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E; v8 &#x5F15;&#x64CE;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x63A5;&#x53D7;&#x72B6;&#x51B5;&#x3002;</li>
<li><code>produceCachedData</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x4E14; <code>cachedData</code> &#x4E0D;&#x5B58;&#x5728;&#x7684;&#x65F6;&#x5019;&#xFF0C;V8 &#x5C06;&#x4F1A;&#x8BD5;&#x56FE;&#x4E3A; <code>code</code> &#x751F;&#x6210;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x3002;
&#x4E00;&#x65E6;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x4E00;&#x4E2A;&#x6709; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684; <code>Buffer</code> &#x5C06;&#x4F1A;&#x88AB;&#x751F;&#x6210;&#x548C;&#x50A8;&#x5B58;&#x5728;&#x8FD4;&#x56DE;&#x7684; <code>vm.Script</code> &#x5B9E;&#x4F8B;&#x7684; <code>cachedData</code> &#x5C5E;&#x6027;&#x91CC;&#x3002;
<code>cachedDataProduced</code> &#x7684;&#x503C;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; <code>true</code> &#x6216;&#x8005; <code>false</code>&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x662F;&#x5426;&#x88AB;&#x6210;&#x529F;&#x751F;&#x6210;&#x3002;
&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>script.createCachedData()</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li>
<p><code>importModuleDynamically</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a> &#x5728;&#x8C03;&#x7528; <code>import()</code> &#x65F6;&#x8BC4;&#x4F30;&#x6B64;&#x6A21;&#x5757;&#x671F;&#x95F4;&#x8C03;&#x7528;&#x3002;
&#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x5219;&#x5BF9; <code>import()</code> &#x7684;&#x8C03;&#x7528;&#x5C06;&#x62D2;&#x7EDD; <a href="http://nodejs.cn/s/fqox4U" rel="nofollow"><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code></a>&#x3002;
&#x6B64;&#x9009;&#x9879;&#x662F; <code>--experimental-modules</code> &#x6807;&#x5FD7;&#x7684;&#x5B9E;&#x9A8C; API &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4E0D;&#x5E94;&#x88AB;&#x89C6;&#x4E3A;&#x7A33;&#x5B9A;&#x3002;</p>
<ul>
<li><code>specifier</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x4F20;&#x7ED9; <code>import()</code> &#x7684;&#x8BF4;&#x660E;&#x7B26;&#x3002;</li>
<li><code>module</code> <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a></li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/uwQPrn" target="_blank" rel="nofollow" class="type">&lt;Module Namespace Object&gt;</a> | <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a> &#x8FD4;&#x56DE; <code>vm.SourceTextModule</code> &#x4EE5;&#x5229;&#x7528;&#x9519;&#x8BEF;&#x8DDF;&#x8E2A;&#xFF0C;&#x5E76;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x5305;&#x542B; <code>then</code> &#x51FD;&#x6570;&#x5BFC;&#x51FA;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x95EE;&#x9898;&#x3002;</li>
</ul>
</li>
</ul>
</li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="nofollow" class="type">&lt;any&gt;</a> &#x811A;&#x672C;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;&#x3002;</li>
</ul>
<p><code>vm.runInNewContext()</code> &#x9996;&#x5148;&#x7ED9;&#x6307;&#x5B9A;&#x7684; <code>sandbox</code>&#xFF08;&#x82E5;&#x4E3A; <code>undefined</code>&#xFF0C;&#x5219;&#x4F1A;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;<code>sandbox</code>&#xFF09;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x9694;&#x79BB;&#x7684;&#x4E0A;&#x4E0B;&#x6587;, &#x518D;&#x5728;&#x6B64;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x6267;&#x884C;&#x7F16;&#x8BD1;&#x7684; <code>code</code>&#xFF0C;&#x6700;&#x540E;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;
&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x4F5C;&#x7528;&#x57DF;&#x3002;</p>
<p>&#x5982;&#x679C; <code>options</code> &#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5219;&#x5B83;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x540D;&#x3002;</p>
<p>&#x4EE5;&#x4E0B;&#x7684;&#x4F8B;&#x5B50;&#x4F1A;&#x7F16;&#x8BD1;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF0C;&#x8BE5;&#x4EE3;&#x7801;&#x4F1A;&#x9012;&#x589E;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#xFF0C;&#x7ED9;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x8D4B;&#x503C;&#x3002;&#x540C;&#x65F6;&#x8BE5;&#x4EE3;&#x7801;&#x88AB;&#x7F16;&#x8BD1;&#x540E;&#x4F1A;&#x88AB;&#x591A;&#x6B21;&#x6267;&#x884C;&#x3002;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x4F1A;&#x88AB;&#x7F6E;&#x4E8E; <code>sandbox</code> &#x5BF9;&#x8C61;&#x5185;&#x3002;</p>
<pre><code class="language-js">const util = require(&apos;util&apos;);
const vm = require(&apos;vm&apos;);

const sandbox = {
  animal: &apos;cat&apos;,
  count: 2
};

vm.runInNewContext(&apos;count += 1; name = &quot;kitty&quot;&apos;, sandbox);
console.log(util.inspect(sandbox));

// { animal: &apos;cat&apos;, count: 3, name: &apos;kitty&apos; }
</code></pre>
<h2>vm.runInThisContext(code[, options])<span><a class="mark" href="vm.html#vm_vm_runinthiscontext_code_options" id="vm_vm_runinthiscontext_code_options">#</a></span></h2><p class="tip_wrap"><a href="vm/vm_runinthiscontext_code_options.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/vm_runinthiscontext_code_options.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<div class="api_metadata">
<details class="changelog"><summary>&#x7248;&#x672C;&#x5386;&#x53F2;</summary>
<table>
<tbody><tr><th>&#x7248;&#x672C;</th><th>&#x53D8;&#x66F4;</th></tr>
<tr><td>v6.3.0</td>
<td><p>The <code>breakOnSigint</code> option is supported now.</p></td></tr>
<tr><td>v0.3.1</td>
<td><p><span>&#x65B0;&#x589E;&#x4E8E;: v0.3.1</span></p></td></tr>
</tbody></table>
</details>
</div>
<ul>
<li><code>code</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5C06;&#x88AB;&#x7F16;&#x8BD1;&#x548C;&#x8FD0;&#x884C;&#x7684; JavaScript &#x4EE3;&#x7801;&#x3002;</li>
<li>
<p><code>options</code> <a href="http://nodejs.cn/s/jzn6Ao" target="_blank" rel="nofollow" class="type">&lt;Object&gt;</a> | <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a></p>
<ul>
<li><code>filename</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x5B9A;&#x4E49;&#x4F9B;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x4F7F;&#x7528;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>&apos;evalmachine.&lt;anonymous&gt;&apos;</code>&#x3002;</li>
<li><code>lineOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x663E;&#x793A;&#x7684;&#x884C;&#x53F7;&#x504F;&#x79FB;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>columnOffset</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;number&gt;</a> &#x5B9A;&#x4E49;&#x811A;&#x672C;&#x751F;&#x6210;&#x7684;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x6240;&#x663E;&#x793A;&#x7684;&#x5217;&#x53F7;&#x504F;&#x79FB;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>0</code>&#x3002;</li>
<li><code>displayErrors</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5047;&#x5982;&#x5728;&#x89E3;&#x6790;&#x4EE3;&#x7801;&#x7684;&#x65F6;&#x5019;&#x53D1;&#x751F;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#xFF0C;&#x5F15;&#x8D77;&#x9519;&#x8BEF;&#x7684;&#x884C;&#x5C06;&#x4F1A;&#x88AB;&#x52A0;&#x5165;&#x5806;&#x6808;&#x8DDF;&#x8E2A;&#x4FE1;&#x606F;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>true</code>&#x3002;</li>
<li><code>timeout</code> <a href="http://nodejs.cn/s/SXbo1v" target="_blank" rel="nofollow" class="type">&lt;integer&gt;</a> &#x5B9A;&#x4E49;&#x5728;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x4E4B;&#x524D;&#x6B64; <code>code</code> &#x88AB;&#x5141;&#x8BB8;&#x6267;&#x884C;&#x7684;&#x6700;&#x5927;&#x6BEB;&#x79D2;&#x6570;&#x3002;&#x5047;&#x5982;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x5C06;&#x4F1A;&#x629B;&#x51FA;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a>&#x3002;&#x8BE5;&#x503C;&#x5FC5;&#x987B;&#x662F;&#x4E25;&#x683C;&#x6B63;&#x6574;&#x6570;&#x3002;</li>
<li><code>breakOnSigint</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x82E5;&#x503C;&#x4E3A; <code>true</code>&#xFF0C;&#x5F53;&#x6536;&#x5230; <code>SIGINT</code> (Ctrl+C)&#x4E8B;&#x4EF6;&#x65F6;&#xFF0C;&#x4EE3;&#x7801;&#x4F1A;&#x88AB;&#x7EC8;&#x6B62;&#x6267;&#x884C;&#x3002;
&#x6B64;&#x5916;&#xFF0C;&#x901A;&#x8FC7; <code>process.on(&apos;SIGINT&apos;)</code> &#x65B9;&#x6CD5;&#x6240;&#x8BBE;&#x7F6E;&#x7684;&#x6D88;&#x606F;&#x54CD;&#x5E94;&#x673A;&#x5236;&#x5728;&#x4EE3;&#x7801;&#x88AB;&#x6267;&#x884C;&#x65F6;&#x4F1A;&#x88AB;&#x5C4F;&#x853D;&#xFF0C;&#x4F46;&#x4EE3;&#x7801;&#x88AB;&#x7EC8;&#x6B62;&#x540E;&#x4F1A;&#x88AB;&#x6062;&#x590D;&#x3002;&#x5982;&#x679C;&#x6267;&#x884C;&#x88AB;&#x7EC8;&#x6B62;&#xFF0C;&#x4E00;&#x4E2A;&#x9519;&#x8BEF; <a href="http://nodejs.cn/s/FLTm19" rel="nofollow"><code>Error</code></a> &#x4F1A;&#x88AB;&#x629B;&#x51FA;&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li><code>cachedData</code> <a href="http://nodejs.cn/s/6x1hD3" target="_blank" rel="nofollow" class="type">&lt;Buffer&gt;</a> | <a href="http://nodejs.cn/s/oh3CkV" target="_blank" rel="nofollow" class="type">&lt;TypedArray&gt;</a> | <a href="http://nodejs.cn/s/yCdVkD" target="_blank" rel="nofollow" class="type">&lt;DataView&gt;</a> &#x4E3A;&#x6E90;&#x7801;&#x63D0;&#x4F9B;&#x4E00;&#x4E2A;&#x53EF;&#x9009;&#x7684;&#x5B58;&#x6709; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684; <code>Buffer</code>&#x3001; <code>TypedArray</code> &#x6216; <code>TypedArray</code>&#x3002;
&#x5982;&#x679C;&#x63D0;&#x4F9B;&#x4E86;&#xFF0C;&#x5219; <code>cachedDataRejected</code> &#x7684;&#x503C;&#x5C06;&#x4F1A;&#x88AB;&#x8BBE;&#x4E3A;&#x8981;&#x4E48;&#x4E3A; <code>true</code> &#x8981;&#x4E48;&#x4E3A; <code>false</code>&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E; v8 &#x5F15;&#x64CE;&#x5BF9;&#x6570;&#x636E;&#x7684;&#x63A5;&#x53D7;&#x72B6;&#x51B5;&#x3002;</li>
<li><code>produceCachedData</code> <a href="http://nodejs.cn/s/jFbvuT" target="_blank" rel="nofollow" class="type">&lt;boolean&gt;</a> &#x5F53;&#x503C;&#x4E3A; <code>true</code> &#x4E14; <code>cachedData</code> &#x4E0D;&#x5B58;&#x5728;&#x7684;&#x65F6;&#x5019;&#xFF0C;V8 &#x5C06;&#x4F1A;&#x8BD5;&#x56FE;&#x4E3A; <code>code</code> &#x751F;&#x6210;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x3002;
&#x4E00;&#x65E6;&#x6210;&#x529F;&#xFF0C;&#x5219;&#x4E00;&#x4E2A;&#x6709; V8 &#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x7684; <code>Buffer</code> &#x5C06;&#x4F1A;&#x88AB;&#x751F;&#x6210;&#x548C;&#x50A8;&#x5B58;&#x5728;&#x8FD4;&#x56DE;&#x7684; <code>vm.Script</code> &#x5B9E;&#x4F8B;&#x7684; <code>cachedData</code> &#x5C5E;&#x6027;&#x91CC;&#x3002;
<code>cachedDataProduced</code> &#x7684;&#x503C;&#x4F1A;&#x88AB;&#x8BBE;&#x7F6E;&#x4E3A; <code>true</code> &#x6216;&#x8005; <code>false</code>&#xFF0C;&#x8FD9;&#x53D6;&#x51B3;&#x4E8E;&#x4EE3;&#x7801;&#x7F13;&#x5B58;&#x6570;&#x636E;&#x662F;&#x5426;&#x88AB;&#x6210;&#x529F;&#x751F;&#x6210;&#x3002;
&#x4E0D;&#x63A8;&#x8350;&#x4F7F;&#x7528;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x800C;&#x5E94;&#x8BE5;&#x4F7F;&#x7528; <code>script.createCachedData()</code>&#x3002;<strong>&#x9ED8;&#x8BA4;&#x503C;:</strong> <code>false</code>&#x3002;</li>
<li>
<p><code>importModuleDynamically</code> <a href="http://nodejs.cn/s/ceTQa6" target="_blank" rel="nofollow" class="type">&lt;Function&gt;</a> &#x5728;&#x8C03;&#x7528; <code>import()</code> &#x65F6;&#x8BC4;&#x4F30;&#x6B64;&#x6A21;&#x5757;&#x671F;&#x95F4;&#x8C03;&#x7528;&#x3002;
&#x5982;&#x679C;&#x672A;&#x6307;&#x5B9A;&#x6B64;&#x9009;&#x9879;&#xFF0C;&#x5219;&#x5BF9; <code>import()</code> &#x7684;&#x8C03;&#x7528;&#x5C06;&#x62D2;&#x7EDD; <a href="http://nodejs.cn/s/fqox4U" rel="nofollow"><code>ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING</code></a>&#x3002;
&#x6B64;&#x9009;&#x9879;&#x662F; <code>--experimental-modules</code> &#x6807;&#x5FD7;&#x7684;&#x5B9E;&#x9A8C; API &#x7684;&#x4E00;&#x90E8;&#x5206;&#xFF0C;&#x4E0D;&#x5E94;&#x88AB;&#x89C6;&#x4E3A;&#x7A33;&#x5B9A;&#x3002;</p>
<ul>
<li><code>specifier</code> <a href="http://nodejs.cn/s/9Tw2bK" target="_blank" rel="nofollow" class="type">&lt;string&gt;</a> &#x4F20;&#x7ED9; <code>import()</code> &#x7684;&#x8BF4;&#x660E;&#x7B26;&#x3002;</li>
<li><code>module</code> <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a></li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/uwQPrn" target="_blank" rel="nofollow" class="type">&lt;Module Namespace Object&gt;</a> | <a href="http://nodejs.cn/s/v9v4iG" target="_blank" rel="nofollow" class="type">&lt;vm.SourceTextModule&gt;</a> &#x8FD4;&#x56DE; <code>vm.SourceTextModule</code> &#x4EE5;&#x5229;&#x7528;&#x9519;&#x8BEF;&#x8DDF;&#x8E2A;&#xFF0C;&#x5E76;&#x907F;&#x514D;&#x51FA;&#x73B0;&#x5305;&#x542B; <code>then</code> &#x51FD;&#x6570;&#x5BFC;&#x51FA;&#x7684;&#x547D;&#x540D;&#x7A7A;&#x95F4;&#x95EE;&#x9898;&#x3002;</li>
</ul>
</li>
</ul>
</li>
<li>&#x8FD4;&#x56DE;: <a href="http://nodejs.cn/s/6sTGdS" target="_blank" rel="nofollow" class="type">&lt;any&gt;</a> &#x811A;&#x672C;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x8BED;&#x53E5;&#x7684;&#x7ED3;&#x679C;&#x3002;</li>
</ul>
<p><code>vm.runInThisContext()</code> &#x5728;&#x5F53;&#x524D;&#x7684; <code>global</code> &#x5BF9;&#x8C61;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7F16;&#x8BD1;&#x5E76;&#x6267;&#x884C; <code>code</code>&#xFF0C;&#x6700;&#x540E;&#x8FD4;&#x56DE;&#x7ED3;&#x679C;&#x3002;
&#x8FD0;&#x884C;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x4F46;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x5F53;&#x524D;&#x7684; <code>global</code> &#x5BF9;&#x8C61;&#x3002;</p>
<p>&#x5982;&#x679C; <code>options</code> &#x662F;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x5219;&#x5B83;&#x6307;&#x5B9A;&#x6587;&#x4EF6;&#x540D;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x7684;&#x4F8B;&#x5B50;&#x6F14;&#x793A;&#x4E86;&#x4F7F;&#x7528; <code>vm.runInThisContext()</code> &#x548C; JavaScript &#x7684; <a href="http://nodejs.cn/s/qHvCuM" rel="nofollow"><code>eval()</code></a> &#x65B9;&#x6CD5;&#x53BB;&#x6267;&#x884C;&#x76F8;&#x540C;&#x7684;&#x4E00;&#x6BB5;&#x4EE3;&#x7801;&#xFF1A;</p>
<!-- eslint-disable prefer-const -->
<pre><code class="language-js">const vm = require(&apos;vm&apos;);
let localVar = &apos;initial value&apos;;

const vmResult = vm.runInThisContext(&apos;localVar = &quot;vm&quot;;&apos;);
console.log(&apos;vmResult:&apos;, vmResult);
console.log(&apos;localVar:&apos;, localVar);

const evalResult = eval(&apos;localVar = &quot;eval&quot;;&apos;);
console.log(&apos;evalResult:&apos;, evalResult);
console.log(&apos;localVar:&apos;, localVar);

// vmResult: &apos;vm&apos;, localVar: &apos;initial value&apos;
// evalResult: &apos;eval&apos;, localVar: &apos;eval&apos;
</code></pre>
<p>&#x6B63;&#x56E0; <code>vm.runInThisContext()</code> &#x65E0;&#x6CD5;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x6545; <code>localVar</code> &#x7684;&#x503C;&#x4E0D;&#x53D8;&#x3002;
&#x76F8;&#x53CD;&#xFF0C;<a href="http://nodejs.cn/s/qHvCuM" rel="nofollow"><code>eval()</code></a> &#x786E;&#x5B9E;&#x80FD;&#x83B7;&#x53D6;&#x672C;&#x5730;&#x4F5C;&#x7528;&#x57DF;&#xFF0C;&#x6240;&#x4EE5; <code>localVar</code> &#x7684;&#x503C;&#x88AB;&#x6539;&#x53D8;&#x4E86;&#x3002;
&#x5982;&#x6B64;&#x770B;&#x6765;&#xFF0C; <code>vm.runInThisContext()</code> &#x66F4;&#x50CF;&#x662F;<a href="http://nodejs.cn/s/RBapQS" rel="nofollow">&#x95F4;&#x63A5;&#x7684;&#x6267;&#x884C; <code>eval()</code></a>, &#x5C31;&#x50CF; <code>(0,eval)(&apos;code&apos;)</code>&#x3002;</p>
<h2>&#x793A;&#x4F8B;&#xFF1A;&#x5728; VM &#x4E2D;&#x8FD0;&#x884C; HTTP Server<span><a class="mark" href="vm.html#vm_example_running_an_http_server_within_a_vm" id="vm_example_running_an_http_server_within_a_vm">#</a></span></h2><p class="tip_wrap"><a href="vm/example_running_an_http_server_within_a_vm.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/example_running_an_http_server_within_a_vm.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<p>&#x5728;&#x4F7F;&#x7528; <a href="http://nodejs.cn/s/BMPPiK" rel="nofollow"><code>script.runInThisContext()</code></a> &#x6216;&#x8005; <a href="http://nodejs.cn/s/wqeZ5X" rel="nofollow"><code>vm.runInThisContext()</code></a> &#x65F6;&#xFF0C;&#x76EE;&#x6807;&#x4EE3;&#x7801;&#x662F;&#x5728;&#x5F53;&#x524D;&#x7684;V8&#x5168;&#x5C40;&#x5BF9;&#x8C61;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x3002;&#x88AB;&#x4F20;&#x5165;&#x6B64;&#x865A;&#x62DF;&#x673A;&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x76EE;&#x6807;&#x4EE3;&#x7801;&#x4F1A;&#x6709;&#x81EA;&#x5DF1;&#x72EC;&#x7ACB;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x3002;</p>
<p>&#x8981;&#x60F3;&#x7528; <code>http</code> &#x6A21;&#x5757;&#x642D;&#x5EFA;&#x4E00;&#x4E2A;&#x7B80;&#x6613;&#x7684;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x88AB;&#x4F20;&#x5165;&#x7684;&#x4EE3;&#x7801;&#x5FC5;&#x987B;&#x8981;&#x4E48;&#x81EA;&#x5DF1;&#x6267;&#x884C; <code>require(&apos;http&apos;)</code>&#xFF0C;&#x8981;&#x4E48;&#x5F15;&#x7528;&#x4E00;&#x4E2A; <code>http</code>&#xFF0C;&#x6BD4;&#x5982;&#xFF1A;</p>
<pre><code class="language-js">&apos;use strict&apos;;
const vm = require(&apos;vm&apos;);

const code = `
((require) =&gt; {
  const http = require(&apos;http&apos;);

  http.createServer((request, response) =&gt; {
    response.writeHead(200, { &apos;Content-Type&apos;: &apos;text/plain&apos; });
    response.end(&apos;&#x4F60;&#x597D;&#x4E16;&#x754C;\\n&apos;);
  }).listen(8124);

  console.log(&apos;&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;&#x5728; http://127.0.0.1:8124/&apos;);
})`;

vm.runInThisContext(code)(require);
</code></pre>
<p>&#x4E0A;&#x8FF0;&#x4F8B;&#x5B50;&#x4E2D;&#x7684; <code>require()</code> &#x548C;&#x5BFC;&#x51FA;&#x5B83;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x5171;&#x4EAB;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x5728;&#x8FD0;&#x884C;&#x672A;&#x7ECF;&#x8BA4;&#x8BC1;&#x7684;&#x4EE3;&#x7801;&#x65F6;&#x53EF;&#x80FD;&#x4F1A;&#x5F15;&#x5165;&#x98CE;&#x9669;&#xFF0C;&#x6BD4;&#x5982;&#x5728;&#x4E0D;&#x7406;&#x60F3;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4FEE;&#x6539;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x3002;</p>
<h2>&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x610F;&#x5473;&#x7740;&#x4EC0;&#x4E48;&#xFF1F;<span><a class="mark" href="vm.html#vm_what_does_it_mean_to_contextify_an_object" id="vm_what_does_it_mean_to_contextify_an_object">#</a></span></h2><p class="tip_wrap"><a href="vm/what_does_it_mean_to_contextify_an_object.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/what_does_it_mean_to_contextify_an_object.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<p>&#x6240;&#x6709;&#x7528; Node.js &#x6240;&#x8FD0;&#x884C;&#x7684; JavaScript &#x4EE3;&#x7801;&#x90FD;&#x662F;&#x5728;&#x4E00;&#x4E2A;&#x201C;&#x4E0A;&#x4E0B;&#x6587;&#x201D;&#x7684;&#x4F5C;&#x7528;&#x57DF;&#x4E2D;&#x88AB;&#x6267;&#x884C;&#x7684;&#x3002;
&#x6839;&#x636E; <a href="http://nodejs.cn/s/SBcUmh" rel="nofollow">V8 &#x5D4C;&#x5165;&#x5F0F;&#x6307;&#x5357;</a>&#xFF1A;</p>
<blockquote>
<p>&#x5728; V8 &#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;&#x4E0A;&#x4E0B;&#x6587;&#x662F;&#x4E00;&#x4E2A;&#x6267;&#x884C;&#x73AF;&#x5883;&#xFF0C;&#x5B83;&#x5141;&#x8BB8;&#x5206;&#x79BB;&#x7684;&#xFF0C;&#x65E0;&#x5173;&#x7684; JavaScript &#x5E94;&#x7528;&#x5728;&#x4E00;&#x4E2A; V8 &#x7684;&#x5355;&#x4F8B;&#x4E2D;&#x88AB;&#x8FD0;&#x884C;&#x3002;
&#x5FC5;&#x987B;&#x660E;&#x786E;&#x5730;&#x6307;&#x5B9A;&#x7528;&#x4E8E;&#x8FD0;&#x884C;&#x6240;&#x6709; JavaScript &#x4EE3;&#x7801;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x3002;</p>
</blockquote>
<p>&#x5F53;&#x8C03;&#x7528; <code>vm.createContext()</code> &#x65F6;&#xFF0C;&#x4F20;&#x5165;&#x7684; <code>sandbox</code> &#x5BF9;&#x8C61;&#xFF08;&#x6216;&#x8005;&#x65B0;&#x5EFA;&#x7684;&#x4E00;&#x4E2A; <code>sandbox</code> &#x5BF9;&#x8C61;&#xFF0C;&#x82E5;&#x539F; <code>sandbox</code> &#x4E3A; <code>undefined</code>&#xFF09;&#x5728;&#x5E95;&#x5C42;&#x4F1A;&#x548C;&#x4E00;&#x4E2A;&#x65B0;&#x7684;V8&#x4E0A;&#x4E0B;&#x6587;&#x5B9E;&#x4F8B;&#x8054;&#x7CFB;&#x4E0A;&#x3002;
&#x8FD9;&#x4E2A; V8 &#x4E0A;&#x4E0B;&#x6587;&#x5728;&#x4E00;&#x4E2A;&#x9694;&#x79BB;&#x7684;&#x5168;&#x5C40;&#x73AF;&#x5883;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528; <code>vm</code> &#x6A21;&#x5757;&#x7684;&#x65B9;&#x6CD5;&#x8FD0;&#x884C; <code>code</code>&#x3002;
&#x521B;&#x5EFA; V8 &#x4E0A;&#x4E0B;&#x6587;&#x548C;&#x4F7F;&#x4E4B;&#x8054;&#x7CFB;&#x4E0A; <code>sandbox</code> &#x7684;&#x8FC7;&#x7A0B;&#x5728;&#x6B64;&#x6587;&#x6863;&#x4E2D;&#x88AB;&#x79F0;&#x4F5C;&#x4E3A;&quot;&#x4E0A;&#x4E0B;&#x6587;&#x9694;&#x79BB;&#x5316;&quot; <code>sandbox</code>&#x3002;</p>
<h2>&#x5F53;&#x4F7F;&#x7528; process.nextTick()&#x3001;Promise &#x548C; queueMicrotask() &#x65F6;&#x7684;&#x8D85;&#x65F6;&#x9650;&#x5236;<span><a class="mark" href="vm.html#vm_timeout_limitations_when_using_process_nexttick_promises_and_queuemicrotask" id="vm_timeout_limitations_when_using_process_nexttick_promises_and_queuemicrotask">#</a></span></h2><p class="tip_wrap"><a href="vm/timeout_limitations_when_using_process_nexttick_promises_and_queuemicrotask.html" class="tip_trans">&#x4E2D;&#x82F1;&#x5BF9;&#x7167;</a><a rel="nofollow" target="_blank" href="https://github.com/nodejscn/node-api-cn/edit/master/vm/timeout_limitations_when_using_process_nexttick_promises_and_queuemicrotask.md" class="tip_en">&#x63D0;&#x4EA4;&#x4FEE;&#x6539;</a></p>
<p>&#x7531;&#x4E8E;&#x5728; V8 &#x548C; Node.js &#x4E2D;&#x5B9E;&#x73B0;&#x4E86; <code>process.nextTick()</code> &#x961F;&#x5217;&#x548C;&#x4F5C;&#x4E3A; Promise &#x57FA;&#x7840;&#x7684;&#x5FAE;&#x4EFB;&#x52A1;&#x961F;&#x5217;&#x7684;&#x5185;&#x90E8;&#x673A;&#x5236;&#xFF0C;&#x56E0;&#x6B64;&#x5728;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x8FD0;&#x884C;&#x7684;&#x4EE3;&#x7801;&#x53EF;&#x4EE5;&#x4F7F;&#x7528; <code>vm.runInContext()</code>&#x3001; <code>vm.runInNewContext()</code> &#x548C; <code>vm.runInThisContext()</code> &#x8F6C;&#x4E49; <code>timeout</code>&#x3002;</p>
<p>&#x4F8B;&#x5982;&#xFF0C; <code>vm.runInNewContext()</code> &#x6267;&#x884C;&#x7684;&#x4EE5;&#x4E0B;&#x4EE3;&#x7801;&#xFF08;&#x8D85;&#x65F6;&#x4E3A; 5 &#x6BEB;&#x79D2;&#xFF09;&#x4F1A;&#x5728; promise &#x89E3;&#x51B3;&#x540E;&#x8C03;&#x5EA6;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x3002;
&#x8C03;&#x5EA6;&#x7684;&#x5FAA;&#x73AF;&#x6C38;&#x8FDC;&#x4E0D;&#x4F1A;&#x88AB;&#x8D85;&#x65F6;&#x4E2D;&#x65AD;&#xFF1A;</p>
<pre><code class="language-js">const vm = require(&apos;vm&apos;);

function loop() {
  while (1) console.log(Date.now());
}

vm.runInNewContext(
  &apos;Promise.resolve().then(loop);&apos;,
  { loop, console },
  { timeout: 5 }
);
</code></pre>
<p>&#x4F7F;&#x7528; <code>process.nextTick()</code> &#x548C; <code>queueMicrotask()</code> &#x51FD;&#x6570;&#x8C03;&#x5EA6; <code>loop()</code> &#x8C03;&#x7528;&#x65F6;&#x4E5F;&#x4F1A;&#x53D1;&#x751F;&#x6B64;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x51FA;&#x73B0;&#x6B64;&#x95EE;&#x9898;&#x662F;&#x56E0;&#x4E3A;&#x6240;&#x6709;&#x4E0A;&#x4E0B;&#x6587;&#x5171;&#x4EAB;&#x76F8;&#x540C;&#x7684;&#x5FAE;&#x4EFB;&#x52A1;&#x548C; nextTick &#x961F;&#x5217;&#x3002;</p>
        </div>
      </div>
    </div>
  </div>
  <!-- 搜索弹窗 -->
  <!-- <div id="search_modal"></div> -->
  <!-- js -->
  <!--[if lt IE 10]><script src="/static/lib/placeholders.js?20170426"></script><![endif]-->
  
  <script>
    document.write('<script src="http://nodejs.cn/api/'&#32;+&#32;(location.port&#32;?&#32;''&#32;:&#32;'//static.nodejs.cn')&#32;+&#32;'/_static/js/api.js?1576756329672"><\/script>');
  </script>

</body></html>